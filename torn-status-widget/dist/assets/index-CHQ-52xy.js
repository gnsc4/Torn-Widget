import{appWindow as ke,LogicalSize as nt}from"https://cdn.jsdelivr.net/npm/@tauri-apps/api@^1/window.js";import{invoke as Ve}from"https://cdn.jsdelivr.net/npm/@tauri-apps/api@^1/tauri.js";(function(){const ie=document.createElement("link").relList;if(ie&&ie.supports&&ie.supports("modulepreload"))return;for(const p of document.querySelectorAll('link[rel="modulepreload"]'))fe(p);new MutationObserver(p=>{for(const L of p)if(L.type==="childList")for(const ue of L.addedNodes)ue.tagName==="LINK"&&ue.rel==="modulepreload"&&fe(ue)}).observe(document,{childList:!0,subtree:!0});function he(p){const L={};return p.integrity&&(L.integrity=p.integrity),p.referrerPolicy&&(L.referrerPolicy=p.referrerPolicy),p.crossOrigin==="use-credentials"?L.credentials="include":p.crossOrigin==="anonymous"?L.credentials="omit":L.credentials="same-origin",L}function fe(p){if(p.ep)return;p.ep=!0;const L=he(p);fetch(p.href,L)}})();(function(){const ce="1.0.19",ie="https://www.torn.com/forums.php#/p=threads&f=67&t=16473214&b=0&a=0",he="GNSC4 [268863]",fe="https://www.torn.com/profiles.php?XID=268863",p="https://api.github.com/repos/gnsc4/Torn-Widget/releases/latest",L="https://github.com/gnsc4/Torn-Widget/releases",oe="torn_status_api_key_v1_widget",De="torn_status_gui_minimized_v1_widget",ve="torn_autostart_preference_v1_widget",Re="torn_link_type_v1_widget_";let v,m,r={update:null,energy:null,nerve:null,happiness:null,booster:null,medical:null,drug:null,newDay:null},l,E,T,K,Y,X,j,u,C,d,z,V,F,c,y,f,S,k,N,b,x,te,se,w,I,O,D,R,M,B,we,Ie,A,le,Le,G,$,Z,a,H,Ce,xe,P,J,Ee,de=48*3600,Te=6*3600;const be='<svg viewBox="0 0 24 24" fill="currentColor" width="16px" height="16px"><path d="M0 0h24v24H0z" fill="none"/><path d="M20 4H4c-1.1 0-1.99.9-1.99 2L2 18c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2zm0 4l-8 5-8-5V6l8 5 8-5v2z"/></svg>',Se='<svg viewBox="0 0 24 24" fill="currentColor" width="16px" height="16px"><path d="M0 0h24v24H0z" fill="none"/><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 15h-2v-2h2v2zm0-4h-2V7h2v6z"/></svg>',pe={drug:{personal:"https://www.torn.com/item.php#drugs-items",faction:"https://www.torn.com/factions.php?step=your#armoury-drugs",elementId:"drug-cooldown-link",toggleId:"drug-link-type-toggle",personalLabelId:"drug-personal-label",factionLabelId:"drug-faction-label"},booster:{personal:"https://www.torn.com/item.php#energy-d-items",faction:"https://www.torn.com/factions.php?step=your#armoury-boosters",elementId:"booster-cooldown-link",toggleId:"booster-link-type-toggle",personalLabelId:"booster-personal-label",factionLabelId:"booster-faction-label"},medical:{personal:"https://www.torn.com/item.php#medical-items",faction:"https://www.torn.com/factions.php?step=your#armoury-medical",elementIds:["medical-cooldown-link","life-link"],toggleId:"medical-link-type-toggle",personalLabelId:"medical-personal-label",factionLabelId:"medical-faction-label"},energyRefill:{personal:"https://www.torn.com/page.php?sid=points",faction:"https://www.torn.com/factions.php?step=your#armoury-points",elementId:"energy-refill-link",toggleId:"energyRefill-link-type-toggle",personalLabelId:"energyRefill-personal-label",factionLabelId:"energyRefill-faction-label"},nerveRefill:{personal:"https://www.torn.com/page.php?sid=points",faction:"https://www.torn.com/factions.php?step=your#armoury-points",elementId:"nerve-refill-link",toggleId:"nerveRefill-link-type-toggle",personalLabelId:"nerveRefill-personal-label",factionLabelId:"nerveRefill-faction-label"}};let Ae={},_e={};async function Me(){try{await Ve("plugin:autostart|enable"),console.log("Autostart enabled via official plugin.")}catch(e){console.error("Failed to enable autostart via official plugin:",e)}}async function Fe(){try{await Ve("plugin:autostart|disable"),console.log("Autostart disabled via official plugin.")}catch(e){console.error("Failed to disable autostart via official plugin:",e)}}async function q(){if(!l||!ke||!te||!document.getElementById("torn-status-header"))return;const e=l.style.display==="none";e&&(l.style.visibility="hidden",l.style.display="block"),l.offsetHeight;const i=document.getElementById("torn-status-header");let t=0;if(t+=i.offsetHeight,t+=parseInt(getComputedStyle(i).marginBottom)||0,a&&a.style.display==="flex"){t+=a.offsetHeight;const o=getComputedStyle(a);t+=(parseInt(o.paddingTop)||0)+(parseInt(o.paddingBottom)||0)}else{let o=0;const g=[k,x,N,b,$];let h=!0,ee=0;for(const W of g)if(W&&getComputedStyle(W).display!=="none"){const Ue=getComputedStyle(W),ze=parseInt(Ue.marginTop)||0;h?o+=ze:o+=Math.max(ee,ze),o+=W.offsetHeight,ee=parseInt(Ue.marginBottom)||0,h=!1}h||(o+=ee),t+=o}t+=parseInt(getComputedStyle(te).marginTop)||0,t+=te.offsetHeight;const n=getComputedStyle(l),s=t+(parseInt(n.paddingTop)||0)+(parseInt(n.paddingBottom)||0)+(parseInt(n.borderTopWidth)||0)+(parseInt(n.borderBottomWidth)||0)+(a&&a.style.display==="flex"?0:10);e&&(l.style.display="none",l.style.visibility="visible"),requestAnimationFrame(async()=>{try{const o=l.offsetWidth;s>0&&o>0&&await ke.setSize(new nt(Math.ceil(o),Math.ceil(s)))}catch(o){console.error("Error resizing window (RAF):",o)}})}function _(e){if(isNaN(e)||e<0)return"--:--:--";const i=Math.floor(e/3600),t=Math.floor(e%3600/60),n=Math.floor(e%60);return`${String(i).padStart(2,"0")}:${String(t).padStart(2,"0")}:${String(n).padStart(2,"0")}`}function Oe(){if(l=document.getElementById("torn-status-gui"),E=document.getElementById("torn-status-minimize-btn"),we=document.getElementById("torn-status-close-btn"),Ie=document.getElementById("torn-status-settings-btn"),T=document.getElementById("custom-tooltip"),te=document.getElementById("widget-version"),se=document.getElementById("update-notification"),k=document.getElementById("torn-status-api-setup"),le=document.getElementById("torn-api-key-input-main"),Le=document.getElementById("torn-api-key-save-btn-main"),G=k.querySelector(".api-error-main"),$=document.getElementById("first-run-autostart-option"),Z=document.getElementById("first-run-autostart-checkbox"),a=document.getElementById("torn-status-settings-panel"),H=document.getElementById("torn-api-key-input-settings"),Ce=document.getElementById("torn-api-key-save-btn-settings"),xe=document.getElementById("torn-api-key-clear-btn-settings"),P=a.querySelector(".api-error-settings"),J=document.getElementById("settings-autostart-checkbox"),Ee=document.getElementById("settings-panel-close-btn"),!l)return;te&&(te.innerHTML=`Author: <a href="${fe}" target="_blank" title="View Author's Profile">${he}</a> | <a href="${ie}" target="_blank" title="Go to Forum Thread">v${ce}</a><span id="update-notification" style="display:none;"> <a href="#" target="_blank">New version available!</a></span>`,se=document.getElementById("update-notification")),m?(l.classList.add("minimized"),E&&(E.textContent="□",E.title="Maximize")):(l.classList.remove("minimized"),E&&(E.textContent="−",E.title="Minimize")),K=l.querySelector(".life-value-overlay"),A=l.querySelector(".health-bar-fill"),Y=l.querySelector(".energy-value"),X=l.querySelector(".nerve-value"),j=l.querySelector(".happy-value"),u=l.querySelector(".booster-value"),C=l.querySelector(".medical-value"),d=l.querySelector(".drug-value"),z=l.querySelector(".energy-timer"),V=l.querySelector(".nerve-timer"),F=l.querySelector(".happy-timer"),c=l.querySelector(".booster-timer"),y=l.querySelector(".medical-timer"),f=l.querySelector(".drug-timer"),S=l.querySelector(".new-day-timer-value"),x=document.getElementById("torn-status-notifications"),N=document.getElementById("torn-status-content"),b=document.getElementById("torn-status-refills"),D=x.querySelector(".messages-icon"),R=x.querySelector(".messages-count"),M=x.querySelector(".events-icon"),B=x.querySelector(".events-count"),w=b.querySelector(".energy-refill-status"),I=b.querySelector(".nerve-refill-status"),O=b.querySelector(".token-refill-status");for(const t in pe){const n=pe[t];n.elementId?Ae[t]=document.getElementById(n.elementId):n.elementIds&&(Ae[t]=n.elementIds.map(s=>document.getElementById(s))),_e[t]={input:document.getElementById(n.toggleId),personalLabel:document.getElementById(n.personalLabelId),factionLabel:document.getElementById(n.factionLabelId)}}E&&E.addEventListener("click",He),we&&we.addEventListener("click",async()=>{await ke.close()}),Ie&&Ie.addEventListener("click",re),Ee&&Ee.addEventListener("click",re),Le&&Le.addEventListener("click",()=>ye(le,G)),le&&le.addEventListener("keypress",t=>{t.key==="Enter"&&ye(le,G)}),Ce&&Ce.addEventListener("click",()=>ye(H,P,!0)),H&&H.addEventListener("keypress",t=>{t.key==="Enter"&&ye(H,P,!0)}),xe&&xe.addEventListener("click",Qe),Z&&Z.addEventListener("change",Be),J&&J.addEventListener("change",Be);const e=document.getElementById("torn-status-header");e&&e.addEventListener("click",t=>{m&&l.classList.contains("minimized")&&t.target===e&&He()}),l.querySelectorAll(".timer-hover-area").forEach(t=>{t.addEventListener("mouseover",Ye),t.addEventListener("mouseout",Xe),t.addEventListener("mousemove",je)})}function re(){if(!a)return;const e=a.style.display==="flex";a.style.display=e?"none":"flex",e||(H&&(H.value=""),P&&(P.textContent="")),q()}async function Be(e){const i=e.target.checked;localStorage.setItem(ve,i.toString()),i?await Me():await Fe(),Z&&(Z.checked=i),J&&(J.checked=i)}async function Ge(){let e=localStorage.getItem(ve),i=!1;e===null?(i=!0,localStorage.setItem(ve,"true"),e="true"):i=e==="true",i&&await Me();const t=e==="true";Z&&(Z.checked=t),J&&(J.checked=t)}function We(e,i){const t=_e[e];t&&t.personalLabel&&t.factionLabel&&(t.personalLabel.classList.toggle("active-preference",!i),t.factionLabel.classList.toggle("active-preference",i))}function Pe(e,i){const t=pe[e],n=Ae[e];if(!t||!n){console.warn(`No URL details or target element for ${e}`);return}const s=i?t.faction:t.personal;Array.isArray(n)?n.forEach(o=>{o&&(o.href=s)}):n&&(n.href=s),We(e,i)}function Ke(){Object.keys(pe).forEach(e=>{const i=_e[e];if(!i||!i.input){console.warn(`Toggle input not found for ${e}`);return}const n=localStorage.getItem(Re+e)==="faction";i.input.checked=n,Pe(e,n),i.input.addEventListener("change",s=>{const o=s.target.checked;localStorage.setItem(Re+e,o?"faction":"personal"),Pe(e,o)})})}function Ye(e){const t=e.currentTarget.querySelector(".timer");T&&t&&t.dataset.tooltipContent&&(T.innerHTML=t.dataset.tooltipContent,T.style.display="block",Ne(e.pageX,e.pageY))}function Xe(){T&&(T.style.display="none")}function je(e){T&&T.style.display==="block"&&Ne(e.pageX,e.pageY)}function Ne(e,i){if(!T)return;const t=10,n=15;let s=e+t,o=i+n;const g=T.getBoundingClientRect(),h=window.innerWidth||document.documentElement.clientWidth,ee=window.innerHeight||document.documentElement.clientHeight;s+g.width>h&&(s=e-g.width-t),o+g.height>ee&&(o=i-g.height-n),s<0&&(s=0),o<0&&(o=0),T.style.left=`${s}px`,T.style.top=`${o}px`}async function ge(){if(!v){Q({error:"API Key needed",target:"api_main"}),U(!1),r.update&&(clearInterval(r.update),r.update=null),ae();return}const e=`https://api.torn.com/user/?selections=bars,cooldowns,refills,personalstats,notifications&key=${v}&comment=TornStatusWidget_v${ce}`,i=new AbortController,t=setTimeout(()=>i.abort(),1e4);try{const n=await fetch(e,{method:"GET",signal:i.signal});if(clearTimeout(t),!n.ok){let o;try{o=await n.json()}catch{throw new Error(`HTTP error ${n.status}`)}if(o&&o.error){const g=`API Error ${o.error.code}`,h=a&&a.style.display==="flex"?"api_settings":"api_main";Q({error:g,target:h}),o.error.code===2?(v=null,localStorage.removeItem(oe),r.update&&(clearInterval(r.update),r.update=null),U(!1),a&&a.style.display==="flex"&&re(),me()):ae()}else throw new Error(`HTTP error ${n.status}`);return}const s=await n.json();if(s.error){const o=`API Error ${s.error.code}`,g=a&&a.style.display==="flex"?"api_settings":"api_main";Q({error:o,target:g}),s.error.code===2?(v=null,localStorage.removeItem(oe),r.update&&(clearInterval(r.update),r.update=null),U(!1),a&&a.style.display==="flex"&&re(),me()):ae()}else Q(s),Ze(s),$e(),!m&&!(a&&a.style.display==="flex")&&U(!0)}catch(n){clearTimeout(t),n.name==="AbortError"?Q({error:"Timeout",target:"status"}):Q({error:n.message||"Network Error",target:"status"}),ae()}}function Q(e){const i=a&&a.style.display==="flex"?P:G,t=l.querySelector(".status-error");if(i&&(i.textContent=""),t&&(t.textContent=""),e.error){let n;e.target==="api_main"&&G?n=G:e.target==="api_settings"&&P?n=P:e.target==="status"&&t?n=t:i&&(n=i),n&&(n.textContent=`Error: ${e.error}`),q();return}if(e.personalstats&&typeof e.personalstats.boosters_max_cooldown_hours=="number"&&(de=e.personalstats.boosters_max_cooldown_hours*3600),e.notifications){const n=e.notifications.messages||0,s=e.notifications.events||0;D&&(D.innerHTML=be),R&&(R.textContent=n,D.className=n>0?"notification-icon messages-icon red":"notification-icon messages-icon green",R.className=n>0?"notification-count messages-count red":"notification-count messages-count green"),M&&(M.innerHTML=Se),B&&(B.textContent=s,M.className=s>0?"notification-icon events-icon red":"notification-icon events-icon green",B.className=s>0?"notification-count events-count red":"notification-count events-count green")}else D&&(D.innerHTML=be),R&&(R.textContent="N/A",D.className="notification-icon messages-icon green",R.className="notification-count messages-count green"),M&&(M.innerHTML=Se),B&&(B.textContent="N/A",M.className="notification-icon events-icon green",B.className="notification-count events-count green");if(K&&e.life&&typeof e.life.current<"u"&&typeof e.life.maximum<"u"&&e.life.maximum>0){if(K.textContent=`${e.life.current}/${e.life.maximum}`,A){const n=e.life.current/e.life.maximum*100;A.style.width=`${Math.max(0,Math.min(100,n))}%`,n<=25?A.style.backgroundColor="#dc3545":n<=50?A.style.backgroundColor="#ffc107":A.style.backgroundColor="#28a745"}}else K&&(K.textContent="N/A",A&&(A.style.width="0%",A.style.backgroundColor="#444"));Y&&e.energy&&typeof e.energy.current<"u"?Y.textContent=`${e.energy.current}/${e.energy.maximum}`:Y&&(Y.textContent="N/A"),X&&e.nerve&&typeof e.nerve.current<"u"?X.textContent=`${e.nerve.current}/${e.nerve.maximum}`:X&&(X.textContent="N/A"),j&&e.happy&&typeof e.happy.current<"u"?j.textContent=`${e.happy.current}/${e.happy.maximum}`:j&&(j.textContent="N/A"),e.cooldowns?(u&&(u.textContent=e.cooldowns.booster>0?"Active":"Ready",e.cooldowns.booster===0?(u.classList.add("flashing"),c&&c.classList.add("flashing")):(u.classList.remove("flashing"),c&&c.classList.remove("flashing"))),C&&(C.textContent=e.cooldowns.medical>0?"Active":"Ready",e.cooldowns.medical),d&&(d.textContent=e.cooldowns.drug>0?"Active":"Ready",e.cooldowns.drug===0?(d.classList.add("flashing"),f&&f.classList.add("flashing")):(d.classList.remove("flashing"),f&&f.classList.remove("flashing")))):(u&&(u.textContent="N/A",u.classList.remove("flashing"),c&&c.classList.remove("flashing")),C&&(C.textContent="N/A",C.classList.remove("flashing"),y&&y.classList.remove("flashing")),d&&(d.textContent="N/A",d.classList.remove("flashing"),f&&f.classList.remove("flashing"))),e.refills?(w&&(w.textContent=e.refills.energy_refill_used?"Used":"Ready",w.className=e.refills.energy_refill_used?"refill-status used":"refill-status ready"),I&&(I.textContent=e.refills.nerve_refill_used?"Used":"Ready",I.className=e.refills.nerve_refill_used?"refill-status used":"refill-status ready"),O&&(O.textContent=e.refills.token_refill_used?"Used":"Ready",O.className=e.refills.token_refill_used?"refill-status used":"refill-status ready")):(w&&(w.textContent="N/A"),I&&(I.textContent="N/A"),O&&(O.textContent="N/A")),q()}function Ze(e){ae(),e.energy&&typeof e.energy.fulltime<"u"&&z?ne("energy",e.energy.fulltime,z,0):z&&(z.textContent="N/A",z.classList.remove("full")),e.nerve&&typeof e.nerve.fulltime<"u"&&V?ne("nerve",e.nerve.fulltime,V,0):V&&(V.textContent="N/A",V.classList.remove("full")),e.happy&&typeof e.happy.fulltime<"u"&&F?ne("happiness",e.happy.fulltime,F,0):F&&(F.textContent="N/A",F.classList.remove("full")),e.cooldowns&&(typeof e.cooldowns.booster<"u"&&c?e.cooldowns.booster>0?ne("booster",e.cooldowns.booster,c,de):(c.textContent=_(de),c.classList.add("full"),c.classList.add("flashing"),u&&u.classList.add("flashing"),c.dataset.tooltipContent=`Ready
Max Duration: ${_(de)}`):c&&(c.textContent="N/A",c.classList.remove("full","flashing"),u&&u.classList.remove("flashing"),c.dataset.tooltipContent="Booster: N/A"),typeof e.cooldowns.medical<"u"&&y?e.cooldowns.medical>0?ne("medical",e.cooldowns.medical,y,Te):(y.textContent=_(Te),y.classList.add("full"),y.dataset.tooltipContent=`Ready
Max Duration: ${_(Te)}`):y&&(y.textContent="N/A",y.classList.remove("full","flashing"),C&&C.classList.remove("flashing"),y.dataset.tooltipContent="Medical: N/A"),typeof e.cooldowns.drug<"u"&&f?e.cooldowns.drug>0?ne("drug",e.cooldowns.drug,f,0):(f.textContent="Ready",f.classList.add("full"),f.classList.add("flashing"),d&&d.classList.add("flashing"),f.dataset.tooltipContent="Ready"):f&&(f.textContent="N/A",f.classList.remove("full","flashing"),d&&d.classList.remove("flashing"),f.dataset.tooltipContent="Drug: N/A")),Je()}function Je(){if(r.newDay&&clearInterval(r.newDay),!S)return;function e(){const i=new Date,t=new Date(Date.UTC(i.getUTCFullYear(),i.getUTCMonth(),i.getUTCDate()+1,0,0,0,0)),n=Math.floor((t.getTime()-i.getTime())/1e3),s=n<3600&&n>=0;s?S.classList.add("new-day-warning"):S.classList.remove("new-day-warning"),S.textContent=_(n>=0?n:0);let o=!1;w&&(s&&w.textContent==="Ready"?(w.classList.add("flashing"),o=!0):w.classList.remove("flashing")),I&&(s&&I.textContent==="Ready"?(I.classList.add("flashing"),o=!0):I.classList.remove("flashing")),o&&s?S.classList.add("flashing"):S.classList.remove("flashing")}e(),r.newDay=setInterval(e,1e3)}function ne(e,i,t,n){if(!t)return;r[e]&&clearTimeout(r[e]);let s=Number(i);if(isNaN(s)){t.textContent="Error",t.classList.remove("full","flashing"),e==="booster"&&u&&u.classList.remove("flashing"),e==="drug"&&d&&d.classList.remove("flashing"),t.dataset.tooltipContent="Error",r[e]=null;return}let o=null;e==="booster"?o=u:e==="medical"?o=C:e==="drug"&&(o=d);function g(){let h="";const ee=Date.now();if(s<=0)t.classList.add("full"),r[e]=null,(e==="booster"||e==="medical"||e==="drug")&&(o&&(o.textContent="Ready"),(e==="booster"||e==="drug")&&(o&&o.classList.add("flashing"),t.classList.add("flashing"))),(e==="booster"||e==="medical")&&n>0?(t.textContent=_(n),h=`Ready
Max Duration: ${_(n)}`):e==="drug"?(t.textContent="Ready",h="Ready"):(t.textContent="Full",h="Full"),t.dataset.tooltipContent=h;else{t.classList.remove("full","flashing"),o&&o.classList.remove("flashing"),o&&(e==="booster"||e==="medical"||e==="drug")&&(o.textContent="Active");const W=new Date(ee+s*1e3).toLocaleString([],{dateStyle:"short",timeStyle:"medium"});(e==="booster"||e==="medical")&&n>0?(t.textContent=_(s),h=`Ends: ${W}
Used: ${_(s)}`):e==="drug"?(t.textContent=_(s),h=`Ends: ${W}
(Drug active)`):(t.textContent=_(s),h=`Ends: ${W}`),t.dataset.tooltipContent=h,s--,r[e]=setTimeout(g,1e3)}}g()}function me(){Object.keys(r).forEach(t=>{r[t]&&(t==="update"||t==="newDay"?clearInterval(r[t]):clearTimeout(r[t]),r[t]=null)}),[w,I,S,u,c,d,f,C,y].forEach(t=>{t&&t.classList.remove("flashing","new-day-warning")}),[z,V,F,c,y,f,S].forEach(t=>{t&&(t.textContent="--:--:--",t.classList&&t.classList.remove("full"),t.dataset&&(t.dataset.tooltipContent=""))}),K&&(K.textContent="--/--"),A&&(A.style.width="0%"),Y&&(Y.textContent="--/--"),X&&(X.textContent="--/--"),j&&(j.textContent="--/--"),u&&(u.textContent="--"),C&&(C.textContent="--"),d&&(d.textContent="--"),D&&(D.innerHTML=be),R&&(R.textContent="--",D.className="notification-icon messages-icon green",R.className="notification-count messages-count green"),M&&(M.innerHTML=Se),B&&(B.textContent="--",M.className="notification-icon events-icon green",B.className="notification-count events-count green"),w&&(w.textContent="--"),I&&(I.textContent="--"),O&&(O.textContent="--")}function ae(){["energy","nerve","happiness","booster","medical","drug","newDay"].forEach(n=>{r[n]&&(n==="newDay"?clearInterval(r[n]):clearTimeout(r[n]),r[n]=null)}),[w,I,S,u,c,d,f,C,y].forEach(n=>{n&&n.classList.remove("flashing","new-day-warning")}),[z,V,F,c,y,f,S].forEach(n=>{n&&(n.textContent="--:--:--",n.classList&&n.classList.remove("full"),n.dataset&&(n.dataset.tooltipContent=""))})}function $e(){G&&(G.textContent=""),P&&(P.textContent="");const e=l.querySelector(".status-error");e&&(e.textContent="")}function He(){m=!m,l&&l.classList.toggle("minimized",m),E&&(E.textContent=m?"□":"−",E.title=m?"Maximize":"Minimize"),localStorage.setItem(De,m.toString()),!m&&a&&a.style.display==="flex"&&(a.style.display="none",q(),a.style.display="flex"),q(),!m&&v?U(!0):!m&&!v&&U(!1)}function ye(e,i,t=!1){if(!e||!i)return;const n=e.value.trim();n&&/^[a-zA-Z0-9]{16}$/.test(n)?(v=n,localStorage.setItem(oe,v),e.value="",$e(),U(!0),r.update&&clearInterval(r.update),ge(),r.update=setInterval(ge,15e3),t&&re()):i.textContent="Invalid Key format (16 letters/numbers)"}function Qe(){v=null,localStorage.removeItem(oe),r.update&&(clearInterval(r.update),r.update=null),me(),Q({error:"API Key cleared. Enter a new key.",target:"api_settings"}),H&&(H.value="")}function U(e){!k||!x||!N||!b||!l||!$||(e&&v?(x.style.setProperty("display","flex","important"),N.style.setProperty("display","block","important"),b.style.setProperty("display","block","important"),k.style.setProperty("display","none","important"),$.style.display="none"):(k.style.setProperty("display","block","important"),x.style.setProperty("display","none","important"),N.style.setProperty("display","none","important"),b.style.setProperty("display","none","important"),$.style.display=v?"none":"block"),a&&a.style.display==="flex"||q())}function et(e,i){const t=e.replace(/^v/,"").split(".").map(Number),n=i.replace(/^v/,"").split(".").map(Number);for(let s=0;s<Math.max(t.length,n.length);s++){const o=t[s]||0,g=n[s]||0;if(o>g)return!0;if(o<g)return!1}return!1}async function tt(){try{const e=await fetch(p);if(!e.ok){console.error(`GitHub API error: ${e.status}`);return}const t=(await e.json()).tag_name;if(t&&et(t,ce)&&se){const n=se.querySelector("a");n&&(n.href=L,n.textContent=`Update to ${t} available!`),se.style.display="inline",q()}}catch(e){console.error("Failed to check for updates:",e)}}async function qe(){v=localStorage.getItem(oe)||null,m=localStorage.getItem(De)==="true",Oe(),await Ge(),Ke(),tt(),l&&(v?(r.update&&clearInterval(r.update),ge(),r.update=setInterval(ge,15e3),m?(x&&x.style.setProperty("display","flex","important"),N&&N.style.setProperty("display","block","important"),b&&b.style.setProperty("display","block","important"),k&&k.style.setProperty("display","none","important"),$&&($.style.display="none")):U(!0)):(m?(k&&k.style.setProperty("display","block","important"),x&&x.style.setProperty("display","none","important"),N&&N.style.setProperty("display","none","important"),b&&b.style.setProperty("display","none","important"),$&&($.style.display="block")):U(!1),me()),(!m||v&&!(a&&a.style.display==="flex"))&&q())}document.readyState==="complete"||document.readyState==="interactive"?qe():document.addEventListener("DOMContentLoaded",qe)})();
