(function(){const Ce=document.createElement("link").relList;if(Ce&&Ce.supports&&Ce.supports("modulepreload"))return;for(const h of document.querySelectorAll('link[rel="modulepreload"]'))_e(h);new MutationObserver(h=>{for(const S of h)if(S.type==="childList")for(const Ae of S.addedNodes)Ae.tagName==="LINK"&&Ae.rel==="modulepreload"&&_e(Ae)}).observe(document,{childList:!0,subtree:!0});function $e(h){const S={};return h.integrity&&(S.integrity=h.integrity),h.referrerPolicy&&(S.referrerPolicy=h.referrerPolicy),h.crossOrigin==="use-credentials"?S.credentials="include":h.crossOrigin==="anonymous"?S.credentials="omit":S.credentials="same-origin",S}function _e(h){if(h.ep)return;h.ep=!0;const S=$e(h);fetch(h.href,S)}})();const Se=window.__TAURI__.window.appWindow,_t=window.__TAURI__.window.LogicalSize,ft=window.__TAURI__.tauri.invoke;(function(){const we="1.0.31",Ce="https://www.torn.com/forums.php#/p=threads&f=67&t=16473214&b=0&a=0",$e="GNSC4 [268863]",_e="https://www.torn.com/profiles.php?XID=268863",h="https://api.github.com/repos/gnsc4/Torn-Widget/releases/latest",S="https://github.com/gnsc4/Torn-Widget/releases",Ee="torn_status_api_key_v1_widget",Qe="torn_status_gui_minimized_v1_widget",Me="torn_autostart_preference_v1_widget",Be="torn_always_on_top_preference_v1_widget",et="torn_link_type_v1_widget_",Fe="torn_tos_accepted_v1_widget";let v,E,U,o={update:null,energy:null,nerve:null,happiness:null,booster:null,medical:null,drug:null,newDay:null,travel:null,race:null,travelEndFlashTimeout:null,raceEndFlashTimeout:null},r,P,$,ie,oe,le,re,g,M,y,ae,ce,fe,d,b,p,G,F,W,B,_,ye,Le,A,k,ne,O,H,z,V,Ne,qe,N,m,Ue,L,ue,x,Oe,u,He,T,K,w,D,he,Ie,ve,Y,de,f,j,ze,Ve,X,pe,me,Ge,R,ge,ke=48*3600,We=6*3600,Z=null,I=null;const Ke='<svg viewBox="0 0 24 24" fill="currentColor" width="16px" height="16px"><path d="M0 0h24v24H0z" fill="none"/><path d="M20 4H4c-1.1 0-1.99.9-1.99 2L2 18c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2zm0 4l-8 5-8-5V6l8 5 8-5v2z"/></svg>',Ye='<svg viewBox="0 0 24 24" fill="currentColor" width="16px" height="16px"><path d="M0 0h24v24H0z" fill="none"/><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 15h-2v-2h2v2zm0-4h-2V7h2v6z"/></svg>',De={drug:{personal:"https://www.torn.com/item.php#drugs-items",faction:"https://www.torn.com/factions.php?step=your&type=1#/tab=armoury&start=0&sub=drugs",elementId:"drug-cooldown-link",toggleId:"drug-link-type-toggle",personalLabelId:"drug-personal-label",factionLabelId:"drug-faction-label"},booster:{personal:"https://www.torn.com/item.php#energy-d-items",faction:"https://www.torn.com/factions.php?step=your&type=1#/tab=armoury&start=0&sub=boosters",elementId:"booster-cooldown-link",toggleId:"booster-link-type-toggle",personalLabelId:"booster-personal-label",factionLabelId:"booster-faction-label"},medical:{personal:"https://www.torn.com/item.php#medical-items",faction:"https://www.torn.com/factions.php?step=your&type=1#/tab=armoury&start=0&sub=medical",elementIds:["medical-cooldown-link","life-link"],toggleId:"medical-link-type-toggle",personalLabelId:"medical-personal-label",factionLabelId:"medical-faction-label"},energyRefill:{personal:"https://www.torn.com/page.php?sid=points",faction:"https://www.torn.com/factions.php?step=your&type=1#/tab=armoury&start=0&sub=points",elementId:"energy-refill-link",toggleId:"energyRefill-link-type-toggle",personalLabelId:"energyRefill-personal-label",factionLabelId:"energyRefill-faction-label"},nerveRefill:{personal:"https://www.torn.com/page.php?sid=points",faction:"https://www.torn.com/factions.php?step=your&type=1#/tab=armoury&start=0&sub=points",elementId:"nerve-refill-link",toggleId:"nerveRefill-link-type-toggle",personalLabelId:"nerveRefill-personal-label",factionLabelId:"nerveRefill-faction-label"}};let je={},Xe={};async function tt(){try{await ft("plugin:autostart|enable"),console.log("Autostart enabled via official plugin.")}catch(t){console.error("Failed to enable autostart via official plugin:",t)}}async function ut(){try{await ft("plugin:autostart|disable"),console.log("Autostart disabled via official plugin.")}catch(t){console.error("Failed to disable autostart via official plugin:",t)}}async function J(){if(!r||!Se||!ye||!document.getElementById("torn-status-header"))return;const t=r.style.display==="none";t&&(r.style.visibility="hidden",r.style.display="block"),r.offsetHeight;const s=document.getElementById("torn-status-header");let e=0;if(e+=s.offsetHeight,e+=parseInt(getComputedStyle(s).marginBottom)||0,f&&f.style.display==="flex"){e+=f.offsetHeight;const l=getComputedStyle(f);e+=(parseInt(l.paddingTop)||0)+(parseInt(l.paddingBottom)||0)}else{let l=0;const c=[F,_,m,u,W,B,Y];let a=!0,ee=0;for(const te of c)if(te&&getComputedStyle(te).display!=="none"){const at=getComputedStyle(te),ct=parseInt(at.marginTop)||0;a?l+=ct:l+=Math.max(ee,ct),l+=te.offsetHeight,ee=parseInt(at.marginBottom)||0,a=!1}a||(l+=ee),e+=l}e+=parseInt(getComputedStyle(ye).marginTop)||0,e+=ye.offsetHeight;const n=getComputedStyle(r),i=e+(parseInt(n.paddingTop)||0)+(parseInt(n.paddingBottom)||0)+(parseInt(n.borderTopWidth)||0)+(parseInt(n.borderBottomWidth)||0)+(f&&f.style.display==="flex"?0:10);t&&(r.style.display="none",r.style.visibility="visible"),requestAnimationFrame(async()=>{try{const l=r.offsetWidth;i>0&&l>0&&await Se.setSize(new _t(Math.ceil(l),Math.ceil(i)))}catch(l){console.error("Error resizing window (RAF):",l)}})}function C(t){if(isNaN(t)||t<0)return"--:--:--";const s=Math.floor(t/3600),e=Math.floor(t%3600/60),n=Math.floor(t%60);return`${String(s).padStart(2,"0")}:${String(e).padStart(2,"0")}:${String(n).padStart(2,"0")}`}function dt(){if(r=document.getElementById("torn-status-gui"),P=document.getElementById("torn-status-minimize-btn"),Ne=document.getElementById("torn-status-close-btn"),qe=document.getElementById("torn-status-settings-btn"),$=document.getElementById("custom-tooltip"),ye=document.getElementById("widget-version"),Le=document.getElementById("update-notification"),F=document.getElementById("torn-status-api-setup"),he=document.getElementById("torn-api-key-input-main"),Ie=document.getElementById("torn-api-key-save-btn-main"),ve=F.querySelector(".api-error-main"),R=document.getElementById("tos-section"),ge=document.getElementById("tos-checkbox"),Y=document.getElementById("first-run-autostart-option"),de=document.getElementById("first-run-autostart-checkbox"),f=document.getElementById("torn-status-settings-panel"),j=document.getElementById("torn-api-key-input-settings"),ze=document.getElementById("torn-api-key-save-btn-settings"),Ve=document.getElementById("torn-api-key-clear-btn-settings"),X=f.querySelector(".api-error-settings"),pe=document.getElementById("settings-autostart-checkbox"),me=document.getElementById("settings-always-on-top-checkbox"),Ge=document.getElementById("settings-panel-close-btn"),m=document.getElementById("torn-travel-status"),Ue=document.getElementById("travel-link"),Ue&&(L=Ue.querySelector("span:first-child")),ue=m.querySelector(".travel-destination-value"),x=m.querySelector(".travel-timer"),Oe=m.querySelector(".travel-error"),u=document.getElementById("torn-race-status"),He=document.getElementById("race-link"),He&&(T=He.querySelector("span:first-child")),K=u.querySelector(".race-info-value"),w=u.querySelector(".race-timer"),D=u.querySelector(".race-error"),!r)return;ye&&(ye.innerHTML=`Author: <a href="${_e}" target="_blank" title="View Author's Profile">${$e}</a> | <a href="${Ce}" target="_blank" title="Go to Forum Thread">v${we}</a><span id="update-notification" style="display:none;"> <a href="#" target="_blank">New version available!</a></span>`,Le=document.getElementById("update-notification")),E?(r.classList.add("minimized"),P&&(P.textContent="□",P.title="Maximize")):(r.classList.remove("minimized"),P&&(P.textContent="−",P.title="Minimize")),ie=r.querySelector(".life-value-overlay"),N=r.querySelector(".health-bar-fill"),oe=r.querySelector(".energy-value"),le=r.querySelector(".nerve-value"),re=r.querySelector(".happy-value"),g=r.querySelector(".booster-value"),M=r.querySelector(".medical-value"),y=r.querySelector(".drug-value"),ae=r.querySelector(".energy-timer"),ce=r.querySelector(".nerve-timer"),fe=r.querySelector(".happy-timer"),d=r.querySelector(".booster-timer"),b=r.querySelector(".medical-timer"),p=r.querySelector(".drug-timer"),G=r.querySelector(".new-day-timer-value"),_=document.getElementById("torn-status-notifications"),W=document.getElementById("torn-status-content"),B=document.getElementById("torn-status-refills"),O=_.querySelector(".messages-icon"),H=_.querySelector(".messages-count"),z=_.querySelector(".events-icon"),V=_.querySelector(".events-count"),A=B.querySelector(".energy-refill-status"),k=B.querySelector(".nerve-refill-status"),ne=B.querySelector(".token-refill-status");for(const e in De){const n=De[e];n.elementId?je[e]=document.getElementById(n.elementId):n.elementIds&&(je[e]=n.elementIds.map(i=>document.getElementById(i))),Xe[e]={input:document.getElementById(n.toggleId),personalLabel:document.getElementById(n.personalLabelId),factionLabel:document.getElementById(n.factionLabelId)}}P&&P.addEventListener("click",lt),Ne&&Ne.addEventListener("click",async()=>{await Se.close()}),qe&&qe.addEventListener("click",Ze),Ge&&Ge.addEventListener("click",Ze),Ie&&Ie.addEventListener("click",()=>Je(he,ve)),he&&he.addEventListener("input",be),ge&&ge.addEventListener("change",be),ze&&ze.addEventListener("click",()=>Je(j,X,!0)),j&&j.addEventListener("keypress",e=>{e.key==="Enter"&&Je(j,X,!0)}),Ve&&Ve.addEventListener("click",bt),de&&de.addEventListener("change",nt),pe&&pe.addEventListener("change",nt),me&&me.addEventListener("change",pt);const t=document.getElementById("torn-status-header");t&&t.addEventListener("click",e=>{E&&r.classList.contains("minimized")&&e.target===t&&lt()}),r.querySelectorAll(".timer-hover-area").forEach(e=>{e.addEventListener("mouseover",vt),e.addEventListener("mouseout",Tt),e.addEventListener("mousemove",wt)})}function be(){if(!Ie||!he||!ge)return;const t=/^[a-zA-Z0-9]{16}$/.test(he.value.trim());Ie.disabled=!(t&&ge.checked)}function Ze(){if(!f)return;const t=f.style.display==="flex";f.style.display=t?"none":"flex",t||(j&&(j.value=""),X&&(X.textContent="")),J()}async function nt(t){const s=t.target.checked;localStorage.setItem(Me,s.toString()),s?await tt():await ut(),de&&(de.checked=s),pe&&(pe.checked=s)}async function pt(t){const s=t.target.checked;localStorage.setItem(Be,s.toString());try{await Se.setAlwaysOnTop(s),console.log(`Always on Top ${s?"enabled":"disabled"}`)}catch(e){console.error("Failed to set always on top:",e)}me&&(me.checked=s)}async function mt(){let t=localStorage.getItem(Me),s=!1;t===null?(s=!0,localStorage.setItem(Me,"true"),t="true"):s=t==="true",s&&await tt();const e=t==="true";de&&(de.checked=e),pe&&(pe.checked=e)}async function gt(){let t=localStorage.getItem(Be),s=!0;t===null?localStorage.setItem(Be,"true"):s=t==="true";try{await Se.setAlwaysOnTop(s),console.log(`Initial Always on Top set to: ${s}`)}catch(e){console.error("Failed to set initial always on top state:",e)}me&&(me.checked=s)}function yt(t,s){const e=Xe[t];e&&e.personalLabel&&e.factionLabel&&(e.personalLabel.classList.toggle("active-preference",!s),e.factionLabel.classList.toggle("active-preference",s))}function st(t,s){const e=De[t],n=je[t];if(!e||!n){console.warn(`No URL details or target element for ${t}`);return}const i=s?e.faction:e.personal;Array.isArray(n)?n.forEach(l=>{l&&(l.href=i)}):n&&(n.href=i),yt(t,s)}function ht(){Object.keys(De).forEach(t=>{const s=Xe[t];if(!s||!s.input){console.warn(`Toggle input not found for ${t}`);return}const n=localStorage.getItem(et+t)==="faction";s.input.checked=n,st(t,n),s.input.addEventListener("change",i=>{const l=i.target.checked;localStorage.setItem(et+t,l?"faction":"personal"),st(t,l)})})}function vt(t){const e=t.currentTarget.querySelector(".timer");$&&e&&e.dataset.tooltipContent&&($.innerHTML=e.dataset.tooltipContent,$.style.display="block",it(t.pageX,t.pageY))}function Tt(){$&&($.style.display="none")}function wt(t){$&&$.style.display==="block"&&it(t.pageX,t.pageY)}function it(t,s){if(!$)return;const e=10,n=15;let i=t+e,l=s+n;const c=$.getBoundingClientRect(),a=window.innerWidth||document.documentElement.clientWidth,ee=window.innerHeight||document.documentElement.clientHeight;i+c.width>a&&(i=t-c.width-e),l+c.height>ee&&(l=s-c.height-n),i<0&&(i=0),l<0&&(l=0),$.style.left=`${i}px`,$.style.top=`${l}px`}async function Re(){if(!v){Q({error:"API Key needed",target:"api_main",isTransient:!1}),q(!1),o.update&&(clearInterval(o.update),o.update=null),xe();return}const t=`https://api.torn.com/user/?selections=bars,cooldowns,refills,personalstats,notifications,travel&key=${v}&comment=TornStatusWidget_v${we}`,s=new AbortController,e=setTimeout(()=>s.abort(),1e4);try{const n=await fetch(t,{method:"GET",signal:s.signal});if(clearTimeout(e),n.ok){const i=await n.json();if(i.error)if(i.error.code===2){v=null,localStorage.removeItem(Ee),o.update&&(clearInterval(o.update),o.update=null),xe(),Q({error:`API Error ${i.error.code}`,target:"api_main",isTransient:!1}),q(!1);return}else Q({error:`API Error ${i.error.code}`,target:"status",isTransient:!0});else Z=i,Q(Z),Et(Z),ot("primary")}else{let i;try{i=await n.json()}catch{throw new Error(`HTTP error ${n.status}`)}if(i&&i.error){const l=`API Error ${i.error.code}`;if(i.error.code===2){v=null,localStorage.removeItem(Ee),o.update&&(clearInterval(o.update),o.update=null),xe(),Q({error:l,target:"api_main",isTransient:!1}),q(!1);return}else Q({error:l,target:"status",isTransient:!0})}else Q({error:`HTTP error ${n.status}`,target:"status",isTransient:!0})}}catch(n){clearTimeout(e);const i=n.name==="AbortError"?"Timeout (User Data)":"Network Error (User Data)";Q({error:i,target:"status",isTransient:!0})}if(v){const n=`https://api.torn.com/v2/user/races?limit=1&sort=DESC&key=${v}&comment=TornStatusWidget_v${we}`,i=new AbortController,l=setTimeout(()=>i.abort(),1e4);try{const c=await fetch(n,{method:"GET",signal:i.signal});if(clearTimeout(l),c.ok){const a=await c.json();a.error?(D&&(D.textContent=`Race API Err: ${a.error.code}`),I?(se(I),Pe(I)):se(null)):(D&&(D.textContent=""),I=a,se(I),Pe(I))}else{let a;try{a=await c.json()}catch{}const ee=a&&a.error?a.error.code:c.status;D&&(D.textContent=`Race API Err: ${ee}`),I?(se(I),Pe(I)):se(null)}}catch(c){clearTimeout(l),D&&(D.textContent=c.name==="AbortError"?"Race Timeout":"Race Net Err"),I?(se(I),Pe(I)):se(null)}}else se(null);!E&&!(f&&f.style.display==="flex")&&q(!!(v&&U)),J()}function Q(t){const s=r.querySelector(".status-error");if(t.error&&!t.isTransient){if(f&&f.style.display,t.target==="api_main"&&ve?ve.textContent=`Error: ${t.error}`:t.target==="api_settings"&&X?X.textContent=`Error: ${t.error}`:s&&(s.textContent=`Error: ${t.error}`),t.target==="api_main"||t.target==="api_settings")return}else t.error&&t.isTransient&&s&&(s.textContent=`Error: ${t.error}`);const e=t.error?Z:t;if(!e){Oe&&!t.error&&(Oe.textContent=""),D&&!t.error&&(D.textContent="");return}if(!t.error){const n=f&&f.style.display==="flex"?X:ve;n&&(n.textContent=""),s&&(s.textContent="")}if(Ct(e.travel),e.personalstats&&typeof e.personalstats.boosters_max_cooldown_hours=="number"&&(ke=e.personalstats.boosters_max_cooldown_hours*3600),e.notifications){const n=e.notifications.messages||0,i=e.notifications.events||0;O&&(O.innerHTML=Ke),H&&(H.textContent=n,O.className=n>0?"notification-icon messages-icon red":"notification-icon messages-icon green",H.className=n>0?"notification-count messages-count red":"notification-count messages-count green"),z&&(z.innerHTML=Ye),V&&(V.textContent=i,z.className=i>0?"notification-icon events-icon red":"notification-icon events-icon green",V.className=i>0?"notification-count events-count red":"notification-count events-count green")}else O&&(O.innerHTML=Ke),H&&(H.textContent="N/A",O.className="notification-icon messages-icon green",H.className="notification-count messages-count green"),z&&(z.innerHTML=Ye),V&&(V.textContent="N/A",z.className="notification-icon events-icon green",V.className="notification-count events-count green");if(ie&&e.life&&typeof e.life.current<"u"&&typeof e.life.maximum<"u"&&e.life.maximum>0){if(ie.textContent=`${e.life.current}/${e.life.maximum}`,N){const n=e.life.current/e.life.maximum*100;N.style.width=`${Math.max(0,Math.min(100,n))}%`,n<=25?N.style.backgroundColor="#dc3545":n<=50?N.style.backgroundColor="#ffc107":N.style.backgroundColor="#28a745"}}else ie&&(ie.textContent="N/A",N&&(N.style.width="0%",N.style.backgroundColor="#444"));oe&&e.energy&&typeof e.energy.current<"u"?oe.textContent=`${e.energy.current}/${e.energy.maximum}`:oe&&(oe.textContent="N/A"),le&&e.nerve&&typeof e.nerve.current<"u"?le.textContent=`${e.nerve.current}/${e.nerve.maximum}`:le&&(le.textContent="N/A"),re&&e.happy&&typeof e.happy.current<"u"?re.textContent=`${e.happy.current}/${e.happy.maximum}`:re&&(re.textContent="N/A"),e.cooldowns?(g&&(g.textContent=e.cooldowns.booster>0?"Active":"Ready",e.cooldowns.booster===0?(g.classList.add("flashing"),d&&d.classList.add("flashing")):(g.classList.remove("flashing"),d&&d.classList.remove("flashing"))),M&&(M.textContent=e.cooldowns.medical>0?"Active":"Ready"),y&&(y.textContent=e.cooldowns.drug>0?"Active":"Ready",e.cooldowns.drug===0?(y.classList.add("flashing"),p&&p.classList.add("flashing")):(y.classList.remove("flashing"),p&&p.classList.remove("flashing")))):(g&&(g.textContent="N/A",g.classList.remove("flashing"),d&&d.classList.remove("flashing")),M&&(M.textContent="N/A",M.classList.remove("flashing"),b&&b.classList.remove("flashing")),y&&(y.textContent="N/A",y.classList.remove("flashing"),p&&p.classList.remove("flashing"))),e.refills?(A&&(A.textContent=e.refills.energy_refill_used?"Used":"Ready",A.className=e.refills.energy_refill_used?"refill-status used":"refill-status ready"),k&&(k.textContent=e.refills.nerve_refill_used?"Used":"Ready",k.className=e.refills.nerve_refill_used?"refill-status used":"refill-status ready"),ne&&(ne.textContent=e.refills.token_refill_used?"Used":"Ready",ne.className=e.refills.token_refill_used?"refill-status used":"refill-status ready")):(A&&(A.textContent="N/A"),k&&(k.textContent="N/A"),ne&&(ne.textContent="N/A"))}function Ct(t){if(!m||!L||!ue||!x)return;const s=t||(Z?Z.travel:null);o.travelEndFlashTimeout&&(clearTimeout(o.travelEndFlashTimeout),o.travelEndFlashTimeout=null),L.classList.remove("label-flash-red"),s&&s.time_left>0?(m.style.display="block",ue.textContent=s.destination||"Unknown",x.textContent=C(s.time_left),x.dataset.tooltipContent=`Arriving in ${s.destination||"Unknown"}`,x.classList.remove("soon")):(L.classList.contains("label-flash-red")||(m.style.display="none"),o.travel&&(clearTimeout(o.travel),o.travel=null))}function se(t){if(!u||!T||!K||!w)return;const s=Math.floor(Date.now()/1e3),e=t||I;if(o.raceEndFlashTimeout&&(clearTimeout(o.raceEndFlashTimeout),o.raceEndFlashTimeout=null),T.classList.remove("label-flash-red"),e&&e.races&&e.races.length>0){const n=e.races[0];if(n.status==="starting"||n.status==="active"||n.status==="in_progress"||n.status==="scheduled"&&n.schedule.start>s){u.style.display="block";let i=`Track: ${n.track_id}`,l="--:--:--",c=`Race: ${n.title}`;if(w.classList.remove("soon"),n.status==="starting"||n.status==="scheduled"&&n.schedule.start>s){const a=n.schedule.start-s;a>0?(l=C(a),i="Starts in:",c+=`
Starts: ${new Date(n.schedule.start*1e3).toLocaleTimeString()}`):(i=n.status==="in_progress"?"In Progress":"Active",l="Ongoing",c+=`
Status: ${n.status}`)}else if(n.status==="active"||n.status==="in_progress"){i=n.status==="in_progress"?"In Progress":"Active";const a=n.schedule.end-s;l=a>0?C(a):"Ending soon",c+=`
Ends: ${new Date(n.schedule.end*1e3).toLocaleTimeString()}`}K.textContent=i,w.textContent=l,w.dataset.tooltipContent=c;return}}T.classList.contains("label-flash-red")||(u.style.display="none"),o.race&&(clearTimeout(o.race),o.race=null)}function Et(t){["energy","nerve","happiness","booster","medical","drug","newDay"].forEach(e=>{o[e]&&(e==="newDay"?clearInterval(o[e]):clearTimeout(o[e]),o[e]=null)}),t.energy&&typeof t.energy.fulltime<"u"&&ae?Te("energy",t.energy.fulltime,ae,0):ae&&(ae.textContent="N/A",ae.classList.remove("full")),t.nerve&&typeof t.nerve.fulltime<"u"&&ce?Te("nerve",t.nerve.fulltime,ce,0):ce&&(ce.textContent="N/A",ce.classList.remove("full")),t.happy&&typeof t.happy.fulltime<"u"&&fe?Te("happiness",t.happy.fulltime,fe,0):fe&&(fe.textContent="N/A",fe.classList.remove("full")),t.cooldowns&&(typeof t.cooldowns.booster<"u"&&d?t.cooldowns.booster>0?Te("booster",t.cooldowns.booster,d,ke):(d.textContent=C(ke),d.classList.add("full"),d.classList.add("flashing"),g&&g.classList.add("flashing"),d.dataset.tooltipContent=`Ready
Max Duration: ${C(ke)}`):d&&(d.textContent="N/A",d.classList.remove("full","flashing"),g&&g.classList.remove("flashing"),d.dataset.tooltipContent="Booster: N/A"),typeof t.cooldowns.medical<"u"&&b?t.cooldowns.medical>0?Te("medical",t.cooldowns.medical,b,We):(b.textContent=C(We),b.classList.add("full"),b.dataset.tooltipContent=`Ready
Max Duration: ${C(We)}`):b&&(b.textContent="N/A",b.classList.remove("full","flashing"),M&&M.classList.remove("flashing"),b.dataset.tooltipContent="Medical: N/A"),typeof t.cooldowns.drug<"u"&&p?t.cooldowns.drug>0?Te("drug",t.cooldowns.drug,p,0):(p.textContent="Ready",p.classList.add("full"),p.classList.add("flashing"),y&&y.classList.add("flashing"),p.dataset.tooltipContent="Ready"):p&&(p.textContent="N/A",p.classList.remove("full","flashing"),y&&y.classList.remove("flashing"),p.dataset.tooltipContent="Drug: N/A")),It(),Lt(t.travel)}function Lt(t){o.travel&&clearTimeout(o.travel),o.travelEndFlashTimeout&&(clearTimeout(o.travelEndFlashTimeout),o.travelEndFlashTimeout=null,L&&L.classList.remove("label-flash-red"));const s=t||(Z?Z.travel:null);if(!x||!s||s.time_left<=0){m&&!(L&&L.classList.contains("label-flash-red"))&&(m.style.display="none");return}let e=s.time_left;m.style.display="block",L&&L.classList.remove("label-flash-red");function n(){e<=0?(x.textContent="Arrived!",x.classList.remove("soon"),ue.textContent=s.destination||"Destination",L&&L.classList.add("label-flash-red"),o.travel=null,o.travelEndFlashTimeout&&clearTimeout(o.travelEndFlashTimeout),o.travelEndFlashTimeout=setTimeout(()=>{L&&L.classList.remove("label-flash-red"),m&&(m.style.display="none"),J()},1e4)):(x.textContent=C(e),ue.textContent=s.destination||"Destination",x.dataset.tooltipContent=`Arriving in ${s.destination||"Unknown"} at ${new Date((s.timestamp-s.time_left+e)*1e3).toLocaleTimeString()}`,e<=60?x.classList.add("soon"):x.classList.remove("soon"),e--,o.travel=setTimeout(n,1e3))}n()}function Pe(t){o.race&&clearTimeout(o.race),o.raceEndFlashTimeout&&(clearTimeout(o.raceEndFlashTimeout),o.raceEndFlashTimeout=null,T&&T.classList.remove("label-flash-red"));const s=t||I;if(!w||!s||!s.races||s.races.length===0){u&&!(T&&T.classList.contains("label-flash-red"))&&(u.style.display="none");return}const e=s.races[0],n=Math.floor(Date.now()/1e3);let i=0,l="none";if(e.status==="starting"||e.status==="scheduled"&&e.schedule.start>n?(i=e.schedule.start-n,l="starting"):(e.status==="active"||e.status==="in_progress")&&(i=e.schedule.end-n,l="active_ending"),l==="none"||i<0){u&&!(T&&T.classList.contains("label-flash-red"))&&(u.style.display="none");return}u.style.display="block",T&&T.classList.remove("label-flash-red");function c(){if(i<=0){o.race=null,l==="starting"?(K.textContent=e.status==="in_progress"?"In Progress":"Active",w.textContent="Ongoing",w.dataset.tooltipContent=`Race: ${e.title}
Status: ${e.status}`):l==="active_ending"&&(K.textContent="Finished!",w.textContent="--:--:--",w.dataset.tooltipContent=`Race: ${e.title}
Status: Finished`,T&&T.classList.add("label-flash-red"),o.raceEndFlashTimeout&&clearTimeout(o.raceEndFlashTimeout),o.raceEndFlashTimeout=setTimeout(()=>{T&&T.classList.remove("label-flash-red"),u&&(u.style.display="none"),J()},1e4));return}w.textContent=C(i),l==="starting"?(K.textContent="Starts in:",w.dataset.tooltipContent=`Race: ${e.title}
Starts at: ${new Date(e.schedule.start*1e3).toLocaleTimeString()}`):l==="active_ending"&&(K.textContent="Ends in:",w.dataset.tooltipContent=`Race: ${e.title}
Ends at: ${new Date(e.schedule.end*1e3).toLocaleTimeString()}`),i<=60?w.classList.add("soon"):w.classList.remove("soon"),i--,o.race=setTimeout(c,1e3)}c()}function It(){if(o.newDay&&clearInterval(o.newDay),!G)return;function t(){const s=new Date,e=new Date(Date.UTC(s.getUTCFullYear(),s.getUTCMonth(),s.getUTCDate()+1,0,0,0,0)),n=Math.floor((e.getTime()-s.getTime())/1e3),i=n<3600&&n>=0;i?G.classList.add("new-day-warning"):G.classList.remove("new-day-warning"),G.textContent=C(n>=0?n:0);let l=!1;A&&(i&&A.textContent==="Ready"?(A.classList.add("flashing"),l=!0):A.classList.remove("flashing")),k&&(i&&k.textContent==="Ready"?(k.classList.add("flashing"),l=!0):k.classList.remove("flashing")),l&&i?G.classList.add("flashing"):G.classList.remove("flashing")}t(),o.newDay=setInterval(t,1e3)}function Te(t,s,e,n){if(!e)return;o[t]&&clearTimeout(o[t]);let i=Number(s);if(isNaN(i)){e.textContent="Error",e.classList.remove("full","flashing"),t==="booster"&&g&&g.classList.remove("flashing"),t==="drug"&&y&&y.classList.remove("flashing"),e.dataset.tooltipContent="Error",o[t]=null;return}let l=null;t==="booster"?l=g:t==="medical"?l=M:t==="drug"&&(l=y);function c(){let a="";const ee=Date.now();if(i<=0)e.classList.add("full"),o[t]=null,(t==="booster"||t==="medical"||t==="drug")&&(l&&(l.textContent="Ready"),(t==="booster"||t==="drug")&&(l&&l.classList.add("flashing"),e.classList.add("flashing"))),(t==="booster"||t==="medical")&&n>0?(e.textContent=C(n),a=`Ready
Max Duration: ${C(n)}`):t==="drug"?(e.textContent="Ready",a="Ready"):(e.textContent="Full",a="Full"),e.dataset.tooltipContent=a;else{e.classList.remove("full","flashing"),l&&l.classList.remove("flashing"),l&&(t==="booster"||t==="medical"||t==="drug")&&(l.textContent="Active");const te=new Date(ee+i*1e3).toLocaleString([],{dateStyle:"short",timeStyle:"medium"});(t==="booster"||t==="medical")&&n>0?(e.textContent=C(i),a=`Ends: ${te}
Used: ${C(i)}`):t==="drug"?(e.textContent=C(i),a=`Ends: ${te}
(Drug active)`):(e.textContent=C(i),a=`Ends: ${te}`),e.dataset.tooltipContent=a,i--,o[t]=setTimeout(c,1e3)}}c()}function xe(){Object.keys(o).forEach(e=>{o[e]&&(e==="update"||e==="newDay"?clearInterval(o[e]):clearTimeout(o[e]),o[e]=null)}),Z=null,I=null,[A,k,G,g,d,y,p,M,b,x,w,L,T].forEach(e=>{e&&e.classList.remove("flashing","new-day-warning","soon","label-flash-red")}),[ae,ce,fe,d,b,p,G,x,w].forEach(e=>{e&&(e.textContent="--:--:--",e.classList&&e.classList.remove("full"),e.dataset&&(e.dataset.tooltipContent=""))}),ie&&(ie.textContent="--/--"),N&&(N.style.width="0%"),oe&&(oe.textContent="--/--"),le&&(le.textContent="--/--"),re&&(re.textContent="--/--"),g&&(g.textContent="--"),M&&(M.textContent="--"),y&&(y.textContent="--"),O&&(O.innerHTML=Ke),H&&(H.textContent="--",O.className="notification-icon messages-icon green",H.className="notification-count messages-count green"),z&&(z.innerHTML=Ye),V&&(V.textContent="--",z.className="notification-icon events-icon green",V.className="notification-count events-count green"),A&&(A.textContent="--"),k&&(k.textContent="--"),ne&&(ne.textContent="--"),ue&&(ue.textContent="--"),K&&(K.textContent="--"),m&&(m.style.display="none"),u&&(u.style.display="none")}function ot(t="all"){if(t==="all"||t==="primary"){const s=F.querySelector(".api-error-main"),e=f.querySelector(".api-error-settings"),n=r.querySelector(".status-error");s&&(s.textContent=""),e&&(e.textContent=""),n&&(n.textContent="")}(t==="all"||t==="race")&&D&&(D.textContent="")}function lt(){E=!E,r&&r.classList.toggle("minimized",E),P&&(P.textContent=E?"□":"−",P.title=E?"Maximize":"Minimize"),localStorage.setItem(Qe,E.toString()),!E&&f&&f.style.display==="flex"&&(f.style.display="none",J(),f.style.display="flex"),J(),!E&&v&&U?q(!0):!E&&(!v||!U)&&q(!1)}function Je(t,s,e=!1){if(!t||!s)return;const n=t.value.trim();if(!e&&ge&&!ge.checked){s.textContent="Please accept the Terms of Service.";return}n&&/^[a-zA-Z0-9]{16}$/.test(n)?(v=n,localStorage.setItem(Ee,v),e||(localStorage.setItem(Fe,"true"),U=!0),R&&(R.style.display="none"),t.value="",ot(),q(!0),o.update&&clearInterval(o.update),Re(),o.update=setInterval(Re,15e3),e&&Ze()):s.textContent="Invalid Key format (16 letters/numbers)",e||be()}function bt(){v=null,localStorage.removeItem(Ee),o.update&&(clearInterval(o.update),o.update=null),xe(),Q({error:"API Key cleared. Enter a new key.",target:"api_settings",isTransient:!1}),q(!1),j&&(j.value="")}function q(t){!F||!_||!W||!B||!r||!Y||!m||!u||!R||(U=localStorage.getItem(Fe)==="true",t&&v&&U?(_.style.setProperty("display","flex","important"),W.style.setProperty("display","block","important"),B.style.setProperty("display","block","important"),F.style.setProperty("display","none","important"),Y.style.display="none",R.style.display="none"):(F.style.setProperty("display","block","important"),_.style.setProperty("display","none","important"),W.style.setProperty("display","none","important"),B.style.setProperty("display","none","important"),m.style.setProperty("display","none","important"),u.style.setProperty("display","none","important"),U?R.style.display="none":R.style.display="block",Y.style.display=v?"none":"block",be()))}function xt(t,s){const e=t.replace(/^v/,"").split(".").map(Number),n=s.replace(/^v/,"").split(".").map(Number);for(let i=0;i<Math.max(e.length,n.length);i++){const l=e[i]||0,c=n[i]||0;if(l>c)return!0;if(l<c)return!1}return!1}async function St(){try{const t=await fetch(h);if(!t.ok){console.error(`GitHub API error: ${t.status}`);return}const e=(await t.json()).tag_name;if(e&&xt(e,we)&&Le){const n=Le.querySelector("a");n&&(n.href=S,n.textContent=`Update to ${e} available!`),Le.style.display="inline",J()}}catch(t){console.error("Failed to check for updates:",t)}}async function rt(){v=localStorage.getItem(Ee)||null,E=localStorage.getItem(Qe)==="true",U=localStorage.getItem(Fe)==="true",dt(),await mt(),await gt(),ht(),St(),r&&(!v||!U?(E?(F&&F.style.setProperty("display","block","important"),_&&_.style.setProperty("display","none","important"),W&&W.style.setProperty("display","none","important"),B&&B.style.setProperty("display","none","important"),m&&m.style.setProperty("display","none","important"),u&&u.style.setProperty("display","none","important"),!U&&R?R.style.display="block":R&&(R.style.display="none"),Y&&(Y.style.display="block")):q(!1),v||xe(),be()):(o.update&&clearInterval(o.update),Re(),o.update=setInterval(Re,15e3),E?(_&&_.style.setProperty("display","flex","important"),W&&W.style.setProperty("display","block","important"),B&&B.style.setProperty("display","block","important"),F&&F.style.setProperty("display","none","important"),Y&&(Y.style.display="none"),R&&(R.style.display="none")):q(!0)),setTimeout(J,100))}document.readyState==="complete"||document.readyState==="interactive"?rt():document.addEventListener("DOMContentLoaded",rt)})();
