import{appWindow as Se,LogicalSize as Ve}from"https://cdn.jsdelivr.net/npm/@tauri-apps/api@^1/window.js";import{invoke as ke}from"https://cdn.jsdelivr.net/npm/@tauri-apps/api@^1/tauri.js";(function(){const te=document.createElement("link").relList;if(te&&te.supports&&te.supports("modulepreload"))return;for(const d of document.querySelectorAll('link[rel="modulepreload"]'))re(d);new MutationObserver(d=>{for(const f of d)if(f.type==="childList")for(const Z of f.addedNodes)Z.tagName==="LINK"&&Z.rel==="modulepreload"&&re(Z)}).observe(document,{childList:!0,subtree:!0});function de(d){const f={};return d.integrity&&(f.integrity=d.integrity),d.referrerPolicy&&(f.referrerPolicy=d.referrerPolicy),d.crossOrigin==="use-credentials"?f.credentials="include":d.crossOrigin==="anonymous"?f.credentials="omit":f.credentials="same-origin",f}function re(d){if(d.ep)return;d.ep=!0;const f=de(d);fetch(d.href,f)}})();(function(){const fe="1.0.2",te="https://www.torn.com/forums.php#/p=threads&f=67&t=16473214&b=0&a=0",de="GNSC4 [268863]",re="https://www.torn.com/profiles.php?XID=268863",f="torn_status_api_key_v1_widget",Z="torn_status_gui_minimized_v1_widget",pe="torn_autostart_preference_v1_widget";let y,p,l={update:null,energy:null,nerve:null,happiness:null,booster:null,medical:null,drug:null},o,g,v,V,O,F,K,C,x,E,U,W,G,S,A,w,T,k,h,m,J,P,H,$,b,_,L,M,ye,me,ne,ge,q,R,X,s,N,ve,he,D,Y,Ce,le=48*3600,Ae=6*3600;const xe='<svg viewBox="0 0 24 24" fill="currentColor" width="16px" height="16px"><path d="M0 0h24v24H0z" fill="none"/><path d="M20 4H4c-1.1 0-1.99.9-1.99 2L2 18c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2zm0 4l-8 5-8-5V6l8 5 8-5v2z"/></svg>',Ee='<svg viewBox="0 0 24 24" fill="currentColor" width="16px" height="16px"><path d="M0 0h24v24H0z" fill="none"/><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 15h-2v-2h2v2zm0-4h-2V7h2v6z"/></svg>';async function we(){try{await ke("plugin:autostart|enable"),console.log("Autostart enabled via official plugin.")}catch(e){console.error("Failed to enable autostart via official plugin:",e)}}async function Re(){try{await ke("plugin:autostart|disable"),console.log("Autostart disabled via official plugin.")}catch(e){console.error("Failed to disable autostart via official plugin:",e)}}async function z(){if(!o||!Se||!J||!document.getElementById("torn-status-header"))return;const e=o.style.display==="none";e&&(o.style.visibility="hidden",o.style.display="block"),o.offsetHeight;const n=document.getElementById("torn-status-header");let t=0;if(t+=n.offsetHeight,t+=parseInt(getComputedStyle(n).marginBottom)||0,s&&s.style.display==="flex")t+=s.offsetHeight;else{let c=0;const u=[T,m,k,h,R];let I=!0,se=0;for(const ue of u)if(ue&&getComputedStyle(ue).display!=="none"){const Me=getComputedStyle(ue),De=parseInt(Me.marginTop)||0;I?c+=De:c+=Math.max(se,De),c+=ue.offsetHeight,se=parseInt(Me.marginBottom)||0,I=!1}I||(c+=se),t+=c}t+=parseInt(getComputedStyle(J).marginTop)||0,t+=J.offsetHeight;const i=getComputedStyle(o),r=t+(parseInt(i.paddingTop)||0)+(parseInt(i.paddingBottom)||0)+(parseInt(i.borderTopWidth)||0)+(parseInt(i.borderBottomWidth)||0)+10;let a=o.offsetWidth;a+=2,e&&(o.style.display="none",o.style.visibility="visible");try{r>0&&a>0&&await Se.setSize(new Ve(Math.ceil(a),Math.ceil(r)))}catch(c){console.error("Error resizing window:",c)}}function ie(e){if(isNaN(e)||e<0)return"--:--:--";const n=Math.floor(e/3600),t=Math.floor(e%3600/60),i=Math.floor(e%60);return`${String(n).padStart(2,"0")}:${String(t).padStart(2,"0")}:${String(i).padStart(2,"0")}`}function Ne(){if(o=document.getElementById("torn-status-gui"),g=document.getElementById("torn-status-minimize-btn"),ye=document.getElementById("torn-status-close-btn"),me=document.getElementById("torn-status-settings-btn"),v=document.getElementById("custom-tooltip"),J=document.getElementById("widget-version"),T=document.getElementById("torn-status-api-setup"),ne=document.getElementById("torn-api-key-input-main"),ge=document.getElementById("torn-api-key-save-btn-main"),q=T.querySelector(".api-error-main"),R=document.getElementById("first-run-autostart-option"),X=document.getElementById("first-run-autostart-checkbox"),s=document.getElementById("torn-status-settings-panel"),N=document.getElementById("torn-api-key-input-settings"),ve=document.getElementById("torn-api-key-save-btn-settings"),he=document.getElementById("torn-api-key-clear-btn-settings"),D=s.querySelector(".api-error-settings"),Y=document.getElementById("settings-autostart-checkbox"),Ce=document.getElementById("settings-panel-close-btn"),!o)return;J&&(J.innerHTML=`Author: <a href="${re}" target="_blank" title="View Author's Profile">${de}</a> | <a href="${te}" target="_blank" title="Go to Forum Thread">v${fe}</a>`),p?(o.classList.add("minimized"),g&&(g.textContent="□",g.title="Maximize")):(o.classList.remove("minimized"),g&&(g.textContent="−",g.title="Minimize")),V=o.querySelector(".life-value"),O=o.querySelector(".energy-value"),F=o.querySelector(".nerve-value"),K=o.querySelector(".happy-value"),C=o.querySelector(".booster-value"),x=o.querySelector(".medical-value"),E=o.querySelector(".drug-value"),U=o.querySelector(".energy-timer"),W=o.querySelector(".nerve-timer"),G=o.querySelector(".happy-timer"),S=o.querySelector(".booster-timer"),A=o.querySelector(".medical-timer"),w=o.querySelector(".drug-timer"),m=document.getElementById("torn-status-notifications"),k=document.getElementById("torn-status-content"),h=document.getElementById("torn-status-refills"),b=m.querySelector(".messages-icon"),_=m.querySelector(".messages-count"),L=m.querySelector(".events-icon"),M=m.querySelector(".events-count"),P=h.querySelector(".energy-refill-status"),H=h.querySelector(".nerve-refill-status"),$=h.querySelector(".token-refill-status"),g&&g.addEventListener("click",_e),ye&&ye.addEventListener("click",async()=>{await Se.close()}),me&&me.addEventListener("click",Q),Ce&&Ce.addEventListener("click",Q),ge&&ge.addEventListener("click",()=>ce(ne,q)),ne&&ne.addEventListener("keypress",t=>{t.key==="Enter"&&ce(ne,q)}),ve&&ve.addEventListener("click",()=>ce(N,D,!0)),N&&N.addEventListener("keypress",t=>{t.key==="Enter"&&ce(N,D,!0)}),he&&he.addEventListener("click",ze),X&&X.addEventListener("change",Ie),Y&&Y.addEventListener("change",Ie);const e=document.getElementById("torn-status-header");e&&e.addEventListener("click",t=>{p&&o.classList.contains("minimized")&&t.target===e&&_e()}),o.querySelectorAll(".timer-hover-area").forEach(t=>{t.addEventListener("mouseover",Pe),t.addEventListener("mouseout",He),t.addEventListener("mousemove",$e)})}function Q(){if(!s)return;const e=s.style.display==="flex";s.style.display=e?"none":"flex",e||(N&&(N.value=""),D&&(D.textContent="")),setTimeout(z,50)}async function Ie(e){const n=e.target.checked;localStorage.setItem(pe,n.toString()),n?await we():await Re(),X&&(X.checked=n),Y&&(Y.checked=n)}async function Be(){let e=localStorage.getItem(pe),n=!1;e===null?(n=!0,localStorage.setItem(pe,"true"),e="true"):n=e==="true",n&&await we();const t=e==="true";X&&(X.checked=t),Y&&(Y.checked=t)}function Pe(e){const t=e.currentTarget.querySelector(".timer");v&&t&&t.dataset.tooltipContent&&(v.innerHTML=t.dataset.tooltipContent,v.style.display="block",Te(e.pageX,e.pageY))}function He(){v&&(v.style.display="none")}function $e(e){v&&v.style.display==="block"&&Te(e.pageX,e.pageY)}function Te(e,n){if(!v)return;const t=10,i=15;let r=e+t,a=n+i;const c=v.getBoundingClientRect(),u=window.innerWidth||document.documentElement.clientWidth,I=window.innerHeight||document.documentElement.clientHeight;r+c.width>u&&(r=e-c.width-t),a+c.height>I&&(a=n-c.height-i),r<0&&(r=0),a<0&&(a=0),v.style.left=`${r}px`,v.style.top=`${a}px`}async function ae(){if(!y){j({error:"API Key needed",target:"api_main"}),B(!1);return}const e=`https://api.torn.com/user/?selections=bars,cooldowns,refills,personalstats,notifications&key=${y}&comment=TornStatusWidget_v${fe}`,n=new AbortController,t=setTimeout(()=>n.abort(),15e3);try{const i=await fetch(e,{method:"GET",signal:n.signal});if(clearTimeout(t),!i.ok){let a;try{a=await i.json()}catch{throw new Error(`HTTP error ${i.status}`)}if(a&&a.error){const c=`API Error ${a.error.code}`,u=s&&s.style.display==="flex"?"api_settings":"api_main";j({error:c,target:u}),a.error.code===2&&(y=null,localStorage.removeItem(f),l.update&&clearInterval(l.update),l.update=null,B(!1),s&&s.style.display==="flex"&&Q())}else throw new Error(`HTTP error ${i.status}`);oe();return}const r=await i.json();if(r.error){const a=`API Error ${r.error.code}`,c=s&&s.style.display==="flex"?"api_settings":"api_main";j({error:a,target:c}),r.error.code===2&&(y=null,localStorage.removeItem(f),l.update&&clearInterval(l.update),l.update=null,B(!1),s&&s.style.display==="flex"&&Q()),oe()}else j(r),qe(r),be(),!p&&!(s&&s.style.display==="flex")&&B(!0)}catch(i){clearTimeout(t),i.name==="AbortError"?j({error:"Timeout",target:"status"}):j({error:i.message||"Network Error",target:"status"}),oe()}}function j(e){const n=s&&s.style.display==="flex"?D:q,t=o.querySelector(".status-error");if(n&&(n.textContent=""),t&&(t.textContent=""),e.error){let i;e.target==="api_main"&&q?i=q:e.target==="api_settings"&&D?i=D:e.target==="status"&&t?i=t:n&&(i=n),i&&(i.textContent=`Error: ${e.error}`),V&&(V.textContent="--/--"),O&&(O.textContent="--/--"),F&&(F.textContent="--/--"),K&&(K.textContent="--/--"),C&&(C.textContent="--"),x&&(x.textContent="--"),E&&(E.textContent="--"),b&&(b.innerHTML=xe),_&&(_.textContent="--",b.className="notification-icon messages-icon green",_.className="notification-count messages-count green"),L&&(L.innerHTML=Ee),M&&(M.textContent="--",L.className="notification-icon events-icon green",M.className="notification-count events-count green"),P&&(P.textContent="--"),H&&(H.textContent="--"),$&&($.textContent="--"),z();return}if(e.personalstats&&typeof e.personalstats.boosters_max_cooldown_hours=="number"?le=e.personalstats.boosters_max_cooldown_hours*3600:le=48*3600,e.notifications){const i=e.notifications.messages||0,r=e.notifications.events||0;b&&(b.innerHTML=xe),_&&(_.textContent=i,b.className=i>0?"notification-icon messages-icon red":"notification-icon messages-icon green",_.className=i>0?"notification-count messages-count red":"notification-count messages-count green"),L&&(L.innerHTML=Ee),M&&(M.textContent=r,L.className=r>0?"notification-icon events-icon red":"notification-icon events-icon green",M.className=r>0?"notification-count events-count red":"notification-count events-count green")}else b&&(b.innerHTML=xe),_&&(_.textContent="N/A",b.className="notification-icon messages-icon green",_.className="notification-count messages-count green"),L&&(L.innerHTML=Ee),M&&(M.textContent="N/A",L.className="notification-icon events-icon green",M.className="notification-count events-count green");V&&e.life&&typeof e.life.current<"u"?V.textContent=`${e.life.current}/${e.life.maximum}`:V&&(V.textContent="N/A"),O&&e.energy&&typeof e.energy.current<"u"?O.textContent=`${e.energy.current}/${e.energy.maximum}`:O&&(O.textContent="N/A"),F&&e.nerve&&typeof e.nerve.current<"u"?F.textContent=`${e.nerve.current}/${e.nerve.maximum}`:F&&(F.textContent="N/A"),K&&e.happy&&typeof e.happy.current<"u"?K.textContent=`${e.happy.current}/${e.happy.maximum}`:K&&(K.textContent="N/A"),e.cooldowns?(C&&(e.cooldowns.booster>0?(C.textContent="Active",C.style.color="#FFA500"):(C.textContent="Ready",C.style.color="#99dd99")),x&&(e.cooldowns.medical>0?(x.textContent="Active",x.style.color="#FFA500"):(x.textContent="Ready",x.style.color="#AFEEEE")),E&&(e.cooldowns.drug>0?(E.textContent="Active",E.style.color="#FFA500"):(E.textContent="Ready",E.style.color="#DDA0DD"))):(C&&(C.textContent="N/A"),x&&(x.textContent="N/A"),E&&(E.textContent="N/A")),e.refills?(P&&(P.textContent=e.refills.energy_refill_used?"Used":"Ready",P.className=e.refills.energy_refill_used?"refill-status used":"refill-status ready"),H&&(H.textContent=e.refills.nerve_refill_used?"Used":"Ready",H.className=e.refills.nerve_refill_used?"refill-status used":"refill-status ready"),$&&($.textContent=e.refills.token_refill_used?"Used":"Ready",$.className=e.refills.token_refill_used?"refill-status used":"refill-status ready")):(P&&(P.textContent="N/A"),H&&(H.textContent="N/A"),$&&($.textContent="N/A")),z()}function qe(e){oe(),e.energy&&typeof e.energy.fulltime<"u"&&U?ee("energy",e.energy.fulltime,U,0):U&&(U.textContent="N/A",U.classList.remove("full")),e.nerve&&typeof e.nerve.fulltime<"u"&&W?ee("nerve",e.nerve.fulltime,W,0):W&&(W.textContent="N/A",W.classList.remove("full")),e.happy&&typeof e.happy.fulltime<"u"&&G?ee("happiness",e.happy.fulltime,G,0):G&&(G.textContent="N/A",G.classList.remove("full")),e.cooldowns&&(typeof e.cooldowns.booster<"u"&&S?e.cooldowns.booster>0?ee("booster",e.cooldowns.booster,S,le):(S.textContent="Ready",S.classList.add("full"),S.dataset.tooltipContent=`Ready
Max Duration: ${ie(le)}`):S&&(S.textContent="N/A",S.classList.remove("full"),S.dataset.tooltipContent="Booster: N/A"),typeof e.cooldowns.medical<"u"&&A?e.cooldowns.medical>0?ee("medical",e.cooldowns.medical,A,Ae):(A.textContent="Ready",A.classList.add("full"),A.dataset.tooltipContent=`Ready
Max Duration: ${ie(Ae)}`):A&&(A.textContent="N/A",A.classList.remove("full"),A.dataset.tooltipContent="Medical: N/A"),typeof e.cooldowns.drug<"u"&&w?e.cooldowns.drug>0?ee("drug",e.cooldowns.drug,w,0):(w.textContent="Ready",w.classList.add("full"),w.dataset.tooltipContent="Ready"):w&&(w.textContent="N/A",w.classList.remove("full"),w.dataset.tooltipContent="Drug: N/A"))}function ee(e,n,t,i){if(!t)return;l[e]&&clearTimeout(l[e]);let r=Number(n);if(isNaN(r)){t.textContent="Error",t.classList.remove("full"),l[e]=null;return}function a(){let u="";if(r>0){if(u=`Ends: ${new Date(Date.now()+r*1e3).toLocaleString()}`,e==="booster"||e==="medical"){const se=Math.max(0,i-r);u+=`
Available: ${ie(se)}`}}else u="Ready",(e==="booster"||e==="medical")&&(u+=`
Max Duration: ${ie(i)}`);t.dataset.tooltipContent=u}function c(){if(a(),r<=0){t.textContent="Ready",t.classList.add("full"),l[e]=null;let u,I="#99dd99";switch(e){case"booster":u=C,I="#99dd99";break;case"medical":u=x,I="#AFEEEE";break;case"drug":u=E,I="#DDA0DD";break;default:u=null}u?(u.textContent="Ready",u.style.color=I):e!=="energy"&&e!=="nerve"&&e!=="happiness"&&(t.textContent="Full"),a()}else t.classList.remove("full"),t.textContent=ie(r),r--,l[e]=setTimeout(c,1e3)}c()}function oe(){Object.keys(l).forEach(n=>{n!=="update"&&l[n]&&(clearTimeout(l[n]),l[n]=null)}),[U,W,G,S,A,w].forEach(n=>{n&&(n.textContent="--:--:--",n.classList.remove("full"),n.dataset.tooltipContent="")})}function be(){q&&(q.textContent=""),D&&(D.textContent="");const e=o.querySelector(".status-error");e&&(e.textContent="")}function _e(){p=!p,o&&o.classList.toggle("minimized",p),g&&(g.textContent=p?"□":"−",g.title=p?"Maximize":"Minimize"),localStorage.setItem(Z,p.toString()),!p&&s&&s.style.display==="flex"?Q():setTimeout(z,50),!p&&y?B(!0):!p&&!y&&B(!1)}function ce(e,n,t=!1){if(!e||!n)return;const i=e.value.trim();i&&/^[a-zA-Z0-9]{16}$/.test(i)?(y=i,localStorage.setItem(f,y),e.value="",be(),B(!0),l.update&&clearInterval(l.update),ae(),l.update=setInterval(ae,12e4),t&&Q()):n.textContent="Invalid Key format (16 letters/numbers)"}function ze(){y=null,localStorage.removeItem(f),l.update&&(clearInterval(l.update),l.update=null),oe(),j({error:"API Key cleared. Enter new key.",target:"api_settings"}),N&&(N.value="")}function B(e){!T||!m||!k||!h||!o||!R||(e&&y?(m.style.setProperty("display","flex","important"),k.style.setProperty("display","block","important"),h.style.setProperty("display","block","important"),T.style.setProperty("display","none","important"),R.style.display="none"):(T.style.setProperty("display","block","important"),m.style.setProperty("display","none","important"),k.style.setProperty("display","none","important"),h.style.setProperty("display","none","important"),R.style.display=y?"none":"block"),s&&s.style.display==="flex"||setTimeout(z,50))}async function Le(){if(y=localStorage.getItem(f)||null,p=localStorage.getItem(Z)==="true",Ne(),await Be(),!o)return;!y?p?(T&&T.style.setProperty("display","block","important"),m&&m.style.setProperty("display","none","important"),k&&k.style.setProperty("display","none","important"),h&&h.style.setProperty("display","none","important"),R&&(R.style.display="block"),setTimeout(z,50)):B(!1):(l.update&&clearInterval(l.update),ae(),l.update=setInterval(ae,12e4),p?(m&&m.style.setProperty("display","flex","important"),k&&k.style.setProperty("display","block","important"),h&&h.style.setProperty("display","block","important"),T&&T.style.setProperty("display","none","important"),R&&(R.style.display="none"),setTimeout(z,50)):B(!0)),(!p||y)&&(s&&s.style.display==="flex"||setTimeout(z,100))}document.readyState==="complete"||document.readyState==="interactive"?Le():document.addEventListener("DOMContentLoaded",Le)})();
