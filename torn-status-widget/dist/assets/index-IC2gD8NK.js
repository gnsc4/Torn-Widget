(function(){const we=document.createElement("link").relList;if(we&&we.supports&&we.supports("modulepreload"))return;for(const h of document.querySelectorAll('link[rel="modulepreload"]'))be(h);new MutationObserver(h=>{for(const S of h)if(S.type==="childList")for(const Se of S.addedNodes)Se.tagName==="LINK"&&Se.rel==="modulepreload"&&be(Se)}).observe(document,{childList:!0,subtree:!0});function Re(h){const S={};return h.integrity&&(S.integrity=h.integrity),h.referrerPolicy&&(S.referrerPolicy=h.referrerPolicy),h.crossOrigin==="use-credentials"?S.credentials="include":h.crossOrigin==="anonymous"?S.credentials="omit":S.credentials="same-origin",S}function be(h){if(h.ep)return;h.ep=!0;const S=Re(h);fetch(h.href,S)}})();const Xe=window.__TAURI__.window.appWindow,It=window.__TAURI__.window.LogicalSize,at=window.__TAURI__.tauri.invoke;(function(){const Te="1.0.30",we="https://www.torn.com/forums.php#/p=threads&f=67&t=16473214&b=0&a=0",Re="GNSC4 [268863]",be="https://www.torn.com/profiles.php?XID=268863",h="https://api.github.com/repos/gnsc4/Torn-Widget/releases/latest",S="https://github.com/gnsc4/Torn-Widget/releases",Ce="torn_status_api_key_v1_widget",Ze="torn_status_gui_minimized_v1_widget",Pe="torn_autostart_preference_v1_widget",Je="torn_link_type_v1_widget_",Me="torn_tos_accepted_v1_widget";let v,L,U,o={update:null,energy:null,nerve:null,happiness:null,booster:null,medical:null,drug:null,newDay:null,travel:null,race:null,travelEndFlashTimeout:null,raceEndFlashTimeout:null},r,P,M,se,oe,le,re,g,$,y,ae,ce,fe,d,x,p,G,q,W,B,_,ge,Le,A,D,ne,H,z,V,O,$e,Be,F,m,qe,E,ue,b,Fe,u,Ne,T,K,w,k,ye,Ee,he,j,de,f,Y,Ue,He,X,pe,ze,R,me,_e=48*3600,Ve=6*3600,Z=null,I=null;const Oe='<svg viewBox="0 0 24 24" fill="currentColor" width="16px" height="16px"><path d="M0 0h24v24H0z" fill="none"/><path d="M20 4H4c-1.1 0-1.99.9-1.99 2L2 18c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2zm0 4l-8 5-8-5V6l8 5 8-5v2z"/></svg>',Ge='<svg viewBox="0 0 24 24" fill="currentColor" width="16px" height="16px"><path d="M0 0h24v24H0z" fill="none"/><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 15h-2v-2h2v2zm0-4h-2V7h2v6z"/></svg>',Ae={drug:{personal:"https://www.torn.com/item.php#drugs-items",faction:"https://www.torn.com/factions.php?step=your&type=1#/tab=armoury&start=0&sub=drugs",elementId:"drug-cooldown-link",toggleId:"drug-link-type-toggle",personalLabelId:"drug-personal-label",factionLabelId:"drug-faction-label"},booster:{personal:"https://www.torn.com/item.php#energy-d-items",faction:"https://www.torn.com/factions.php?step=your&type=1#/tab=armoury&start=0&sub=boosters",elementId:"booster-cooldown-link",toggleId:"booster-link-type-toggle",personalLabelId:"booster-personal-label",factionLabelId:"booster-faction-label"},medical:{personal:"https://www.torn.com/item.php#medical-items",faction:"https://www.torn.com/factions.php?step=your&type=1#/tab=armoury&start=0&sub=medical",elementIds:["medical-cooldown-link","life-link"],toggleId:"medical-link-type-toggle",personalLabelId:"medical-personal-label",factionLabelId:"medical-faction-label"},energyRefill:{personal:"https://www.torn.com/page.php?sid=points",faction:"https://www.torn.com/factions.php?step=your&type=1#/tab=armoury&start=0&sub=points",elementId:"energy-refill-link",toggleId:"energyRefill-link-type-toggle",personalLabelId:"energyRefill-personal-label",factionLabelId:"energyRefill-faction-label"},nerveRefill:{personal:"https://www.torn.com/page.php?sid=points",faction:"https://www.torn.com/factions.php?step=your&type=1#/tab=armoury&start=0&sub=points",elementId:"nerve-refill-link",toggleId:"nerveRefill-link-type-toggle",personalLabelId:"nerveRefill-personal-label",factionLabelId:"nerveRefill-faction-label"}};let We={},Ke={};async function Qe(){try{await at("plugin:autostart|enable"),console.log("Autostart enabled via official plugin.")}catch(t){console.error("Failed to enable autostart via official plugin:",t)}}async function ct(){try{await at("plugin:autostart|disable"),console.log("Autostart disabled via official plugin.")}catch(t){console.error("Failed to disable autostart via official plugin:",t)}}async function J(){if(!r||!Xe||!ge||!document.getElementById("torn-status-header"))return;const t=r.style.display==="none";t&&(r.style.visibility="hidden",r.style.display="block"),r.offsetHeight;const i=document.getElementById("torn-status-header");let e=0;if(e+=i.offsetHeight,e+=parseInt(getComputedStyle(i).marginBottom)||0,f&&f.style.display==="flex"){e+=f.offsetHeight;const l=getComputedStyle(f);e+=(parseInt(l.paddingTop)||0)+(parseInt(l.paddingBottom)||0)}else{let l=0;const c=[q,_,m,u,W,B,j];let a=!0,ee=0;for(const te of c)if(te&&getComputedStyle(te).display!=="none"){const lt=getComputedStyle(te),rt=parseInt(lt.marginTop)||0;a?l+=rt:l+=Math.max(ee,rt),l+=te.offsetHeight,ee=parseInt(lt.marginBottom)||0,a=!1}a||(l+=ee),e+=l}e+=parseInt(getComputedStyle(ge).marginTop)||0,e+=ge.offsetHeight;const n=getComputedStyle(r),s=e+(parseInt(n.paddingTop)||0)+(parseInt(n.paddingBottom)||0)+(parseInt(n.borderTopWidth)||0)+(parseInt(n.borderBottomWidth)||0)+(f&&f.style.display==="flex"?0:10);t&&(r.style.display="none",r.style.visibility="visible"),requestAnimationFrame(async()=>{try{const l=r.offsetWidth;s>0&&l>0&&await Xe.setSize(new It(Math.ceil(l),Math.ceil(s)))}catch(l){console.error("Error resizing window (RAF):",l)}})}function C(t){if(isNaN(t)||t<0)return"--:--:--";const i=Math.floor(t/3600),e=Math.floor(t%3600/60),n=Math.floor(t%60);return`${String(i).padStart(2,"0")}:${String(e).padStart(2,"0")}:${String(n).padStart(2,"0")}`}function ft(){if(r=document.getElementById("torn-status-gui"),P=document.getElementById("torn-status-minimize-btn"),$e=document.getElementById("torn-status-close-btn"),Be=document.getElementById("torn-status-settings-btn"),M=document.getElementById("custom-tooltip"),ge=document.getElementById("widget-version"),Le=document.getElementById("update-notification"),q=document.getElementById("torn-status-api-setup"),ye=document.getElementById("torn-api-key-input-main"),Ee=document.getElementById("torn-api-key-save-btn-main"),he=q.querySelector(".api-error-main"),R=document.getElementById("tos-section"),me=document.getElementById("tos-checkbox"),j=document.getElementById("first-run-autostart-option"),de=document.getElementById("first-run-autostart-checkbox"),f=document.getElementById("torn-status-settings-panel"),Y=document.getElementById("torn-api-key-input-settings"),Ue=document.getElementById("torn-api-key-save-btn-settings"),He=document.getElementById("torn-api-key-clear-btn-settings"),X=f.querySelector(".api-error-settings"),pe=document.getElementById("settings-autostart-checkbox"),ze=document.getElementById("settings-panel-close-btn"),m=document.getElementById("torn-travel-status"),qe=document.getElementById("travel-link"),qe&&(E=qe.querySelector("span:first-child")),ue=m.querySelector(".travel-destination-value"),b=m.querySelector(".travel-timer"),Fe=m.querySelector(".travel-error"),u=document.getElementById("torn-race-status"),Ne=document.getElementById("race-link"),Ne&&(T=Ne.querySelector("span:first-child")),K=u.querySelector(".race-info-value"),w=u.querySelector(".race-timer"),k=u.querySelector(".race-error"),!r)return;ge&&(ge.innerHTML=`Author: <a href="${be}" target="_blank" title="View Author's Profile">${Re}</a> | <a href="${we}" target="_blank" title="Go to Forum Thread">v${Te}</a><span id="update-notification" style="display:none;"> <a href="#" target="_blank">New version available!</a></span>`,Le=document.getElementById("update-notification")),L?(r.classList.add("minimized"),P&&(P.textContent="□",P.title="Maximize")):(r.classList.remove("minimized"),P&&(P.textContent="−",P.title="Minimize")),se=r.querySelector(".life-value-overlay"),F=r.querySelector(".health-bar-fill"),oe=r.querySelector(".energy-value"),le=r.querySelector(".nerve-value"),re=r.querySelector(".happy-value"),g=r.querySelector(".booster-value"),$=r.querySelector(".medical-value"),y=r.querySelector(".drug-value"),ae=r.querySelector(".energy-timer"),ce=r.querySelector(".nerve-timer"),fe=r.querySelector(".happy-timer"),d=r.querySelector(".booster-timer"),x=r.querySelector(".medical-timer"),p=r.querySelector(".drug-timer"),G=r.querySelector(".new-day-timer-value"),_=document.getElementById("torn-status-notifications"),W=document.getElementById("torn-status-content"),B=document.getElementById("torn-status-refills"),H=_.querySelector(".messages-icon"),z=_.querySelector(".messages-count"),V=_.querySelector(".events-icon"),O=_.querySelector(".events-count"),A=B.querySelector(".energy-refill-status"),D=B.querySelector(".nerve-refill-status"),ne=B.querySelector(".token-refill-status");for(const e in Ae){const n=Ae[e];n.elementId?We[e]=document.getElementById(n.elementId):n.elementIds&&(We[e]=n.elementIds.map(s=>document.getElementById(s))),Ke[e]={input:document.getElementById(n.toggleId),personalLabel:document.getElementById(n.personalLabelId),factionLabel:document.getElementById(n.factionLabelId)}}P&&P.addEventListener("click",st),$e&&$e.addEventListener("click",async()=>{await Xe.close()}),Be&&Be.addEventListener("click",je),ze&&ze.addEventListener("click",je),Ee&&Ee.addEventListener("click",()=>Ye(ye,he)),ye&&ye.addEventListener("input",Ie),me&&me.addEventListener("change",Ie),Ue&&Ue.addEventListener("click",()=>Ye(Y,X,!0)),Y&&Y.addEventListener("keypress",e=>{e.key==="Enter"&&Ye(Y,X,!0)}),He&&He.addEventListener("click",Ct),de&&de.addEventListener("change",et),pe&&pe.addEventListener("change",et);const t=document.getElementById("torn-status-header");t&&t.addEventListener("click",e=>{L&&r.classList.contains("minimized")&&e.target===t&&st()}),r.querySelectorAll(".timer-hover-area").forEach(e=>{e.addEventListener("mouseover",mt),e.addEventListener("mouseout",gt),e.addEventListener("mousemove",yt)})}function Ie(){if(!Ee||!ye||!me)return;const t=/^[a-zA-Z0-9]{16}$/.test(ye.value.trim());Ee.disabled=!(t&&me.checked)}function je(){if(!f)return;const t=f.style.display==="flex";f.style.display=t?"none":"flex",t||(Y&&(Y.value=""),X&&(X.textContent="")),J()}async function et(t){const i=t.target.checked;localStorage.setItem(Pe,i.toString()),i?await Qe():await ct(),de&&(de.checked=i),pe&&(pe.checked=i)}async function ut(){let t=localStorage.getItem(Pe),i=!1;t===null?(i=!0,localStorage.setItem(Pe,"true"),t="true"):i=t==="true",i&&await Qe();const e=t==="true";de&&(de.checked=e),pe&&(pe.checked=e)}function dt(t,i){const e=Ke[t];e&&e.personalLabel&&e.factionLabel&&(e.personalLabel.classList.toggle("active-preference",!i),e.factionLabel.classList.toggle("active-preference",i))}function tt(t,i){const e=Ae[t],n=We[t];if(!e||!n){console.warn(`No URL details or target element for ${t}`);return}const s=i?e.faction:e.personal;Array.isArray(n)?n.forEach(l=>{l&&(l.href=s)}):n&&(n.href=s),dt(t,i)}function pt(){Object.keys(Ae).forEach(t=>{const i=Ke[t];if(!i||!i.input){console.warn(`Toggle input not found for ${t}`);return}const n=localStorage.getItem(Je+t)==="faction";i.input.checked=n,tt(t,n),i.input.addEventListener("change",s=>{const l=s.target.checked;localStorage.setItem(Je+t,l?"faction":"personal"),tt(t,l)})})}function mt(t){const e=t.currentTarget.querySelector(".timer");M&&e&&e.dataset.tooltipContent&&(M.innerHTML=e.dataset.tooltipContent,M.style.display="block",nt(t.pageX,t.pageY))}function gt(){M&&(M.style.display="none")}function yt(t){M&&M.style.display==="block"&&nt(t.pageX,t.pageY)}function nt(t,i){if(!M)return;const e=10,n=15;let s=t+e,l=i+n;const c=M.getBoundingClientRect(),a=window.innerWidth||document.documentElement.clientWidth,ee=window.innerHeight||document.documentElement.clientHeight;s+c.width>a&&(s=t-c.width-e),l+c.height>ee&&(l=i-c.height-n),s<0&&(s=0),l<0&&(l=0),M.style.left=`${s}px`,M.style.top=`${l}px`}async function De(){if(!v){Q({error:"API Key needed",target:"api_main",isTransient:!1}),N(!1),o.update&&(clearInterval(o.update),o.update=null),xe();return}const t=`https://api.torn.com/user/?selections=bars,cooldowns,refills,personalstats,notifications,travel&key=${v}&comment=TornStatusWidget_v${Te}`,i=new AbortController,e=setTimeout(()=>i.abort(),1e4);try{const n=await fetch(t,{method:"GET",signal:i.signal});if(clearTimeout(e),n.ok){const s=await n.json();if(s.error)if(s.error.code===2){v=null,localStorage.removeItem(Ce),o.update&&(clearInterval(o.update),o.update=null),xe(),Q({error:`API Error ${s.error.code}`,target:"api_main",isTransient:!1}),N(!1);return}else Q({error:`API Error ${s.error.code}`,target:"status",isTransient:!0});else Z=s,Q(Z),vt(Z),it("primary")}else{let s;try{s=await n.json()}catch{throw new Error(`HTTP error ${n.status}`)}if(s&&s.error){const l=`API Error ${s.error.code}`;if(s.error.code===2){v=null,localStorage.removeItem(Ce),o.update&&(clearInterval(o.update),o.update=null),xe(),Q({error:l,target:"api_main",isTransient:!1}),N(!1);return}else Q({error:l,target:"status",isTransient:!0})}else Q({error:`HTTP error ${n.status}`,target:"status",isTransient:!0})}}catch(n){clearTimeout(e);const s=n.name==="AbortError"?"Timeout (User Data)":"Network Error (User Data)";Q({error:s,target:"status",isTransient:!0})}if(v){const n=`https://api.torn.com/v2/user/races?limit=1&sort=DESC&key=${v}&comment=TornStatusWidget_v${Te}`,s=new AbortController,l=setTimeout(()=>s.abort(),1e4);try{const c=await fetch(n,{method:"GET",signal:s.signal});if(clearTimeout(l),c.ok){const a=await c.json();a.error?(k&&(k.textContent=`Race API Err: ${a.error.code}`),I?(ie(I),ke(I)):ie(null)):(k&&(k.textContent=""),I=a,ie(I),ke(I))}else{let a;try{a=await c.json()}catch{}const ee=a&&a.error?a.error.code:c.status;k&&(k.textContent=`Race API Err: ${ee}`),I?(ie(I),ke(I)):ie(null)}}catch(c){clearTimeout(l),k&&(k.textContent=c.name==="AbortError"?"Race Timeout":"Race Net Err"),I?(ie(I),ke(I)):ie(null)}}else ie(null);!L&&!(f&&f.style.display==="flex")&&N(!!(v&&U)),J()}function Q(t){const i=r.querySelector(".status-error");if(t.error&&!t.isTransient){if(f&&f.style.display,t.target==="api_main"&&he?he.textContent=`Error: ${t.error}`:t.target==="api_settings"&&X?X.textContent=`Error: ${t.error}`:i&&(i.textContent=`Error: ${t.error}`),t.target==="api_main"||t.target==="api_settings")return}else t.error&&t.isTransient&&i&&(i.textContent=`Error: ${t.error}`);const e=t.error?Z:t;if(!e){Fe&&!t.error&&(Fe.textContent=""),k&&!t.error&&(k.textContent="");return}if(!t.error){const n=f&&f.style.display==="flex"?X:he;n&&(n.textContent=""),i&&(i.textContent="")}if(ht(e.travel),e.personalstats&&typeof e.personalstats.boosters_max_cooldown_hours=="number"&&(_e=e.personalstats.boosters_max_cooldown_hours*3600),e.notifications){const n=e.notifications.messages||0,s=e.notifications.events||0;H&&(H.innerHTML=Oe),z&&(z.textContent=n,H.className=n>0?"notification-icon messages-icon red":"notification-icon messages-icon green",z.className=n>0?"notification-count messages-count red":"notification-count messages-count green"),V&&(V.innerHTML=Ge),O&&(O.textContent=s,V.className=s>0?"notification-icon events-icon red":"notification-icon events-icon green",O.className=s>0?"notification-count events-count red":"notification-count events-count green")}else H&&(H.innerHTML=Oe),z&&(z.textContent="N/A",H.className="notification-icon messages-icon green",z.className="notification-count messages-count green"),V&&(V.innerHTML=Ge),O&&(O.textContent="N/A",V.className="notification-icon events-icon green",O.className="notification-count events-count green");if(se&&e.life&&typeof e.life.current<"u"&&typeof e.life.maximum<"u"&&e.life.maximum>0){if(se.textContent=`${e.life.current}/${e.life.maximum}`,F){const n=e.life.current/e.life.maximum*100;F.style.width=`${Math.max(0,Math.min(100,n))}%`,n<=25?F.style.backgroundColor="#dc3545":n<=50?F.style.backgroundColor="#ffc107":F.style.backgroundColor="#28a745"}}else se&&(se.textContent="N/A",F&&(F.style.width="0%",F.style.backgroundColor="#444"));oe&&e.energy&&typeof e.energy.current<"u"?oe.textContent=`${e.energy.current}/${e.energy.maximum}`:oe&&(oe.textContent="N/A"),le&&e.nerve&&typeof e.nerve.current<"u"?le.textContent=`${e.nerve.current}/${e.nerve.maximum}`:le&&(le.textContent="N/A"),re&&e.happy&&typeof e.happy.current<"u"?re.textContent=`${e.happy.current}/${e.happy.maximum}`:re&&(re.textContent="N/A"),e.cooldowns?(g&&(g.textContent=e.cooldowns.booster>0?"Active":"Ready",e.cooldowns.booster===0?(g.classList.add("flashing"),d&&d.classList.add("flashing")):(g.classList.remove("flashing"),d&&d.classList.remove("flashing"))),$&&($.textContent=e.cooldowns.medical>0?"Active":"Ready"),y&&(y.textContent=e.cooldowns.drug>0?"Active":"Ready",e.cooldowns.drug===0?(y.classList.add("flashing"),p&&p.classList.add("flashing")):(y.classList.remove("flashing"),p&&p.classList.remove("flashing")))):(g&&(g.textContent="N/A",g.classList.remove("flashing"),d&&d.classList.remove("flashing")),$&&($.textContent="N/A",$.classList.remove("flashing"),x&&x.classList.remove("flashing")),y&&(y.textContent="N/A",y.classList.remove("flashing"),p&&p.classList.remove("flashing"))),e.refills?(A&&(A.textContent=e.refills.energy_refill_used?"Used":"Ready",A.className=e.refills.energy_refill_used?"refill-status used":"refill-status ready"),D&&(D.textContent=e.refills.nerve_refill_used?"Used":"Ready",D.className=e.refills.nerve_refill_used?"refill-status used":"refill-status ready"),ne&&(ne.textContent=e.refills.token_refill_used?"Used":"Ready",ne.className=e.refills.token_refill_used?"refill-status used":"refill-status ready")):(A&&(A.textContent="N/A"),D&&(D.textContent="N/A"),ne&&(ne.textContent="N/A"))}function ht(t){if(!m||!E||!ue||!b)return;const i=t||(Z?Z.travel:null);o.travelEndFlashTimeout&&(clearTimeout(o.travelEndFlashTimeout),o.travelEndFlashTimeout=null),E.classList.remove("label-flash-red"),i&&i.time_left>0?(m.style.display="block",ue.textContent=i.destination||"Unknown",b.textContent=C(i.time_left),b.dataset.tooltipContent=`Arriving in ${i.destination||"Unknown"}`,b.classList.remove("soon")):(E.classList.contains("label-flash-red")||(m.style.display="none"),o.travel&&(clearTimeout(o.travel),o.travel=null))}function ie(t){if(!u||!T||!K||!w)return;const i=Math.floor(Date.now()/1e3),e=t||I;if(o.raceEndFlashTimeout&&(clearTimeout(o.raceEndFlashTimeout),o.raceEndFlashTimeout=null),T.classList.remove("label-flash-red"),e&&e.races&&e.races.length>0){const n=e.races[0];if(n.status==="starting"||n.status==="active"||n.status==="in_progress"||n.status==="scheduled"&&n.schedule.start>i){u.style.display="block";let s=`Track: ${n.track_id}`,l="--:--:--",c=`Race: ${n.title}`;if(w.classList.remove("soon"),n.status==="starting"||n.status==="scheduled"&&n.schedule.start>i){const a=n.schedule.start-i;a>0?(l=C(a),s="Starts in:",c+=`
Starts: ${new Date(n.schedule.start*1e3).toLocaleTimeString()}`):(s=n.status==="in_progress"?"In Progress":"Active",l="Ongoing",c+=`
Status: ${n.status}`)}else if(n.status==="active"||n.status==="in_progress"){s=n.status==="in_progress"?"In Progress":"Active";const a=n.schedule.end-i;l=a>0?C(a):"Ending soon",c+=`
Ends: ${new Date(n.schedule.end*1e3).toLocaleTimeString()}`}K.textContent=s,w.textContent=l,w.dataset.tooltipContent=c;return}}T.classList.contains("label-flash-red")||(u.style.display="none"),o.race&&(clearTimeout(o.race),o.race=null)}function vt(t){["energy","nerve","happiness","booster","medical","drug","newDay"].forEach(e=>{o[e]&&(e==="newDay"?clearInterval(o[e]):clearTimeout(o[e]),o[e]=null)}),t.energy&&typeof t.energy.fulltime<"u"&&ae?ve("energy",t.energy.fulltime,ae,0):ae&&(ae.textContent="N/A",ae.classList.remove("full")),t.nerve&&typeof t.nerve.fulltime<"u"&&ce?ve("nerve",t.nerve.fulltime,ce,0):ce&&(ce.textContent="N/A",ce.classList.remove("full")),t.happy&&typeof t.happy.fulltime<"u"&&fe?ve("happiness",t.happy.fulltime,fe,0):fe&&(fe.textContent="N/A",fe.classList.remove("full")),t.cooldowns&&(typeof t.cooldowns.booster<"u"&&d?t.cooldowns.booster>0?ve("booster",t.cooldowns.booster,d,_e):(d.textContent=C(_e),d.classList.add("full"),d.classList.add("flashing"),g&&g.classList.add("flashing"),d.dataset.tooltipContent=`Ready
Max Duration: ${C(_e)}`):d&&(d.textContent="N/A",d.classList.remove("full","flashing"),g&&g.classList.remove("flashing"),d.dataset.tooltipContent="Booster: N/A"),typeof t.cooldowns.medical<"u"&&x?t.cooldowns.medical>0?ve("medical",t.cooldowns.medical,x,Ve):(x.textContent=C(Ve),x.classList.add("full"),x.dataset.tooltipContent=`Ready
Max Duration: ${C(Ve)}`):x&&(x.textContent="N/A",x.classList.remove("full","flashing"),$&&$.classList.remove("flashing"),x.dataset.tooltipContent="Medical: N/A"),typeof t.cooldowns.drug<"u"&&p?t.cooldowns.drug>0?ve("drug",t.cooldowns.drug,p,0):(p.textContent="Ready",p.classList.add("full"),p.classList.add("flashing"),y&&y.classList.add("flashing"),p.dataset.tooltipContent="Ready"):p&&(p.textContent="N/A",p.classList.remove("full","flashing"),y&&y.classList.remove("flashing"),p.dataset.tooltipContent="Drug: N/A")),wt(),Tt(t.travel)}function Tt(t){o.travel&&clearTimeout(o.travel),o.travelEndFlashTimeout&&(clearTimeout(o.travelEndFlashTimeout),o.travelEndFlashTimeout=null,E&&E.classList.remove("label-flash-red"));const i=t||(Z?Z.travel:null);if(!b||!i||i.time_left<=0){m&&!(E&&E.classList.contains("label-flash-red"))&&(m.style.display="none");return}let e=i.time_left;m.style.display="block",E&&E.classList.remove("label-flash-red");function n(){e<=0?(b.textContent="Arrived!",b.classList.remove("soon"),ue.textContent=i.destination||"Destination",E&&E.classList.add("label-flash-red"),o.travel=null,o.travelEndFlashTimeout&&clearTimeout(o.travelEndFlashTimeout),o.travelEndFlashTimeout=setTimeout(()=>{E&&E.classList.remove("label-flash-red"),m&&(m.style.display="none"),J()},1e4)):(b.textContent=C(e),ue.textContent=i.destination||"Destination",b.dataset.tooltipContent=`Arriving in ${i.destination||"Unknown"} at ${new Date((i.timestamp-i.time_left+e)*1e3).toLocaleTimeString()}`,e<=60?b.classList.add("soon"):b.classList.remove("soon"),e--,o.travel=setTimeout(n,1e3))}n()}function ke(t){o.race&&clearTimeout(o.race),o.raceEndFlashTimeout&&(clearTimeout(o.raceEndFlashTimeout),o.raceEndFlashTimeout=null,T&&T.classList.remove("label-flash-red"));const i=t||I;if(!w||!i||!i.races||i.races.length===0){u&&!(T&&T.classList.contains("label-flash-red"))&&(u.style.display="none");return}const e=i.races[0],n=Math.floor(Date.now()/1e3);let s=0,l="none";if(e.status==="starting"||e.status==="scheduled"&&e.schedule.start>n?(s=e.schedule.start-n,l="starting"):(e.status==="active"||e.status==="in_progress")&&(s=e.schedule.end-n,l="active_ending"),l==="none"||s<0){u&&!(T&&T.classList.contains("label-flash-red"))&&(u.style.display="none");return}u.style.display="block",T&&T.classList.remove("label-flash-red");function c(){if(s<=0){o.race=null,l==="starting"?(K.textContent=e.status==="in_progress"?"In Progress":"Active",w.textContent="Ongoing",w.dataset.tooltipContent=`Race: ${e.title}
Status: ${e.status}`):l==="active_ending"&&(K.textContent="Finished!",w.textContent="--:--:--",w.dataset.tooltipContent=`Race: ${e.title}
Status: Finished`,T&&T.classList.add("label-flash-red"),o.raceEndFlashTimeout&&clearTimeout(o.raceEndFlashTimeout),o.raceEndFlashTimeout=setTimeout(()=>{T&&T.classList.remove("label-flash-red"),u&&(u.style.display="none"),J()},1e4));return}w.textContent=C(s),l==="starting"?(K.textContent="Starts in:",w.dataset.tooltipContent=`Race: ${e.title}
Starts at: ${new Date(e.schedule.start*1e3).toLocaleTimeString()}`):l==="active_ending"&&(K.textContent="Ends in:",w.dataset.tooltipContent=`Race: ${e.title}
Ends at: ${new Date(e.schedule.end*1e3).toLocaleTimeString()}`),s<=60?w.classList.add("soon"):w.classList.remove("soon"),s--,o.race=setTimeout(c,1e3)}c()}function wt(){if(o.newDay&&clearInterval(o.newDay),!G)return;function t(){const i=new Date,e=new Date(Date.UTC(i.getUTCFullYear(),i.getUTCMonth(),i.getUTCDate()+1,0,0,0,0)),n=Math.floor((e.getTime()-i.getTime())/1e3),s=n<3600&&n>=0;s?G.classList.add("new-day-warning"):G.classList.remove("new-day-warning"),G.textContent=C(n>=0?n:0);let l=!1;A&&(s&&A.textContent==="Ready"?(A.classList.add("flashing"),l=!0):A.classList.remove("flashing")),D&&(s&&D.textContent==="Ready"?(D.classList.add("flashing"),l=!0):D.classList.remove("flashing")),l&&s?G.classList.add("flashing"):G.classList.remove("flashing")}t(),o.newDay=setInterval(t,1e3)}function ve(t,i,e,n){if(!e)return;o[t]&&clearTimeout(o[t]);let s=Number(i);if(isNaN(s)){e.textContent="Error",e.classList.remove("full","flashing"),t==="booster"&&g&&g.classList.remove("flashing"),t==="drug"&&y&&y.classList.remove("flashing"),e.dataset.tooltipContent="Error",o[t]=null;return}let l=null;t==="booster"?l=g:t==="medical"?l=$:t==="drug"&&(l=y);function c(){let a="";const ee=Date.now();if(s<=0)e.classList.add("full"),o[t]=null,(t==="booster"||t==="medical"||t==="drug")&&(l&&(l.textContent="Ready"),(t==="booster"||t==="drug")&&(l&&l.classList.add("flashing"),e.classList.add("flashing"))),(t==="booster"||t==="medical")&&n>0?(e.textContent=C(n),a=`Ready
Max Duration: ${C(n)}`):t==="drug"?(e.textContent="Ready",a="Ready"):(e.textContent="Full",a="Full"),e.dataset.tooltipContent=a;else{e.classList.remove("full","flashing"),l&&l.classList.remove("flashing"),l&&(t==="booster"||t==="medical"||t==="drug")&&(l.textContent="Active");const te=new Date(ee+s*1e3).toLocaleString([],{dateStyle:"short",timeStyle:"medium"});(t==="booster"||t==="medical")&&n>0?(e.textContent=C(s),a=`Ends: ${te}
Used: ${C(s)}`):t==="drug"?(e.textContent=C(s),a=`Ends: ${te}
(Drug active)`):(e.textContent=C(s),a=`Ends: ${te}`),e.dataset.tooltipContent=a,s--,o[t]=setTimeout(c,1e3)}}c()}function xe(){Object.keys(o).forEach(e=>{o[e]&&(e==="update"||e==="newDay"?clearInterval(o[e]):clearTimeout(o[e]),o[e]=null)}),Z=null,I=null,[A,D,G,g,d,y,p,$,x,b,w,E,T].forEach(e=>{e&&e.classList.remove("flashing","new-day-warning","soon","label-flash-red")}),[ae,ce,fe,d,x,p,G,b,w].forEach(e=>{e&&(e.textContent="--:--:--",e.classList&&e.classList.remove("full"),e.dataset&&(e.dataset.tooltipContent=""))}),se&&(se.textContent="--/--"),F&&(F.style.width="0%"),oe&&(oe.textContent="--/--"),le&&(le.textContent="--/--"),re&&(re.textContent="--/--"),g&&(g.textContent="--"),$&&($.textContent="--"),y&&(y.textContent="--"),H&&(H.innerHTML=Oe),z&&(z.textContent="--",H.className="notification-icon messages-icon green",z.className="notification-count messages-count green"),V&&(V.innerHTML=Ge),O&&(O.textContent="--",V.className="notification-icon events-icon green",O.className="notification-count events-count green"),A&&(A.textContent="--"),D&&(D.textContent="--"),ne&&(ne.textContent="--"),ue&&(ue.textContent="--"),K&&(K.textContent="--"),m&&(m.style.display="none"),u&&(u.style.display="none")}function it(t="all"){if(t==="all"||t==="primary"){const i=q.querySelector(".api-error-main"),e=f.querySelector(".api-error-settings"),n=r.querySelector(".status-error");i&&(i.textContent=""),e&&(e.textContent=""),n&&(n.textContent="")}(t==="all"||t==="race")&&k&&(k.textContent="")}function st(){L=!L,r&&r.classList.toggle("minimized",L),P&&(P.textContent=L?"□":"−",P.title=L?"Maximize":"Minimize"),localStorage.setItem(Ze,L.toString()),!L&&f&&f.style.display==="flex"&&(f.style.display="none",J(),f.style.display="flex"),J(),!L&&v&&U?N(!0):!L&&(!v||!U)&&N(!1)}function Ye(t,i,e=!1){if(!t||!i)return;const n=t.value.trim();if(!e&&me&&!me.checked){i.textContent="Please accept the Terms of Service.";return}n&&/^[a-zA-Z0-9]{16}$/.test(n)?(v=n,localStorage.setItem(Ce,v),e||(localStorage.setItem(Me,"true"),U=!0),R&&(R.style.display="none"),t.value="",it(),N(!0),o.update&&clearInterval(o.update),De(),o.update=setInterval(De,15e3),e&&je()):i.textContent="Invalid Key format (16 letters/numbers)",e||Ie()}function Ct(){v=null,localStorage.removeItem(Ce),o.update&&(clearInterval(o.update),o.update=null),xe(),Q({error:"API Key cleared. Enter a new key.",target:"api_settings",isTransient:!1}),N(!1),Y&&(Y.value="")}function N(t){!q||!_||!W||!B||!r||!j||!m||!u||!R||(U=localStorage.getItem(Me)==="true",t&&v&&U?(_.style.setProperty("display","flex","important"),W.style.setProperty("display","block","important"),B.style.setProperty("display","block","important"),q.style.setProperty("display","none","important"),j.style.display="none",R.style.display="none"):(q.style.setProperty("display","block","important"),_.style.setProperty("display","none","important"),W.style.setProperty("display","none","important"),B.style.setProperty("display","none","important"),m.style.setProperty("display","none","important"),u.style.setProperty("display","none","important"),U?R.style.display="none":R.style.display="block",j.style.display=v?"none":"block",Ie()))}function Lt(t,i){const e=t.replace(/^v/,"").split(".").map(Number),n=i.replace(/^v/,"").split(".").map(Number);for(let s=0;s<Math.max(e.length,n.length);s++){const l=e[s]||0,c=n[s]||0;if(l>c)return!0;if(l<c)return!1}return!1}async function Et(){try{const t=await fetch(h);if(!t.ok){console.error(`GitHub API error: ${t.status}`);return}const e=(await t.json()).tag_name;if(e&&Lt(e,Te)&&Le){const n=Le.querySelector("a");n&&(n.href=S,n.textContent=`Update to ${e} available!`),Le.style.display="inline",J()}}catch(t){console.error("Failed to check for updates:",t)}}async function ot(){v=localStorage.getItem(Ce)||null,L=localStorage.getItem(Ze)==="true",U=localStorage.getItem(Me)==="true",ft(),await ut(),pt(),Et(),r&&(!v||!U?(L?(q&&q.style.setProperty("display","block","important"),_&&_.style.setProperty("display","none","important"),W&&W.style.setProperty("display","none","important"),B&&B.style.setProperty("display","none","important"),m&&m.style.setProperty("display","none","important"),u&&u.style.setProperty("display","none","important"),!U&&R?R.style.display="block":R&&(R.style.display="none"),j&&(j.style.display="block")):N(!1),v||xe(),Ie()):(o.update&&clearInterval(o.update),De(),o.update=setInterval(De,15e3),L?(_&&_.style.setProperty("display","flex","important"),W&&W.style.setProperty("display","block","important"),B&&B.style.setProperty("display","block","important"),q&&q.style.setProperty("display","none","important"),j&&(j.style.display="none"),R&&(R.style.display="none")):N(!0)),setTimeout(J,100))}document.readyState==="complete"||document.readyState==="interactive"?ot():document.addEventListener("DOMContentLoaded",ot)})();
