(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const p of document.querySelectorAll('link[rel="modulepreload"]'))d(p);new MutationObserver(p=>{for(const E of p)if(E.type==="childList")for(const L of E.addedNodes)L.tagName==="LINK"&&L.rel==="modulepreload"&&d(L)}).observe(document,{childList:!0,subtree:!0});function s(p){const E={};return p.integrity&&(E.integrity=p.integrity),p.referrerPolicy&&(E.referrerPolicy=p.referrerPolicy),p.crossOrigin==="use-credentials"?E.credentials="include":p.crossOrigin==="anonymous"?E.credentials="omit":E.credentials="same-origin",E}function d(p){if(p.ep)return;p.ep=!0;const E=s(p);fetch(p.href,E)}})();function Qt(i,e,s,d){if(typeof e=="function"?i!==e||!0:!e.has(i))throw new TypeError("Cannot read private member from an object whose class did not declare it");return s==="m"?d:s==="a"?d.call(i):d?d.value:e.get(i)}function en(i,e,s,d,p){if(typeof e=="function"?i!==e||!0:!e.has(i))throw new TypeError("Cannot write private member to an object whose class did not declare it");return e.set(i,s),s}var He;const H="__TAURI_TO_IPC_KEY__";function tn(i,e=!1){return window.__TAURI_INTERNALS__.transformCallback(i,e)}async function a(i,e={},s){return window.__TAURI_INTERNALS__.invoke(i,e,s)}class kt{get rid(){return Qt(this,He,"f")}constructor(e){He.set(this,void 0),en(this,He,e)}async close(){return a("plugin:resources|close",{rid:this.rid})}}He=new WeakMap;class yt{constructor(...e){this.type="Logical",e.length===1?"Logical"in e[0]?(this.width=e[0].Logical.width,this.height=e[0].Logical.height):(this.width=e[0].width,this.height=e[0].height):(this.width=e[0],this.height=e[1])}toPhysical(e){return new Me(this.width*e,this.height*e)}[H](){return{width:this.width,height:this.height}}toJSON(){return this[H]()}}class Me{constructor(...e){this.type="Physical",e.length===1?"Physical"in e[0]?(this.width=e[0].Physical.width,this.height=e[0].Physical.height):(this.width=e[0].width,this.height=e[0].height):(this.width=e[0],this.height=e[1])}toLogical(e){return new yt(this.width/e,this.height/e)}[H](){return{width:this.width,height:this.height}}toJSON(){return this[H]()}}class Ae{constructor(e){this.size=e}toLogical(e){return this.size instanceof yt?this.size:this.size.toLogical(e)}toPhysical(e){return this.size instanceof Me?this.size:this.size.toPhysical(e)}[H](){return{[`${this.size.type}`]:{width:this.size.width,height:this.size.height}}}toJSON(){return this[H]()}}class Rt{constructor(...e){this.type="Logical",e.length===1?"Logical"in e[0]?(this.x=e[0].Logical.x,this.y=e[0].Logical.y):(this.x=e[0].x,this.y=e[0].y):(this.x=e[0],this.y=e[1])}toPhysical(e){return new pe(this.x*e,this.y*e)}[H](){return{x:this.x,y:this.y}}toJSON(){return this[H]()}}class pe{constructor(...e){this.type="Physical",e.length===1?"Physical"in e[0]?(this.x=e[0].Physical.x,this.y=e[0].Physical.y):(this.x=e[0].x,this.y=e[0].y):(this.x=e[0],this.y=e[1])}toLogical(e){return new Rt(this.x/e,this.y/e)}[H](){return{x:this.x,y:this.y}}toJSON(){return this[H]()}}class Ue{constructor(e){this.position=e}toLogical(e){return this.position instanceof Rt?this.position:this.position.toLogical(e)}toPhysical(e){return this.position instanceof pe?this.position:this.position.toPhysical(e)}[H](){return{[`${this.position.type}`]:{x:this.position.x,y:this.position.y}}}toJSON(){return this[H]()}}var W;(function(i){i.WINDOW_RESIZED="tauri://resize",i.WINDOW_MOVED="tauri://move",i.WINDOW_CLOSE_REQUESTED="tauri://close-requested",i.WINDOW_DESTROYED="tauri://destroyed",i.WINDOW_FOCUS="tauri://focus",i.WINDOW_BLUR="tauri://blur",i.WINDOW_SCALE_FACTOR_CHANGED="tauri://scale-change",i.WINDOW_THEME_CHANGED="tauri://theme-changed",i.WINDOW_CREATED="tauri://window-created",i.WEBVIEW_CREATED="tauri://webview-created",i.DRAG_ENTER="tauri://drag-enter",i.DRAG_OVER="tauri://drag-over",i.DRAG_DROP="tauri://drag-drop",i.DRAG_LEAVE="tauri://drag-leave"})(W||(W={}));async function Pt(i,e){await a("plugin:event|unlisten",{event:i,eventId:e})}async function Ve(i,e,s){var d;const p=typeof(s==null?void 0:s.target)=="string"?{kind:"AnyLabel",label:s.target}:(d=s==null?void 0:s.target)!==null&&d!==void 0?d:{kind:"Any"};return a("plugin:event|listen",{event:i,target:p,handler:tn(e)}).then(E=>async()=>Pt(i,E))}async function nn(i,e,s){return Ve(i,d=>{Pt(i,d.id),e(d)},s)}async function sn(i,e){await a("plugin:event|emit",{event:i,payload:e})}async function ln(i,e,s){await a("plugin:event|emit_to",{target:typeof i=="string"?{kind:"AnyLabel",label:i}:i,event:e,payload:s})}class Ne extends kt{constructor(e){super(e)}static async new(e,s,d){return a("plugin:image|new",{rgba:Ge(e),width:s,height:d}).then(p=>new Ne(p))}static async fromBytes(e){return a("plugin:image|from_bytes",{bytes:Ge(e)}).then(s=>new Ne(s))}static async fromPath(e){return a("plugin:image|from_path",{path:e}).then(s=>new Ne(s))}async rgba(){return a("plugin:image|rgba",{rid:this.rid}).then(e=>new Uint8Array(e))}async size(){return a("plugin:image|size",{rid:this.rid})}}function Ge(i){return i==null?null:typeof i=="string"?i:i instanceof Ne?i.rid:i}var pt;(function(i){i[i.Critical=1]="Critical",i[i.Informational=2]="Informational"})(pt||(pt={}));class an{constructor(e){this._preventDefault=!1,this.event=e.event,this.id=e.id}preventDefault(){this._preventDefault=!0}isPreventDefault(){return this._preventDefault}}var It;(function(i){i.None="none",i.Normal="normal",i.Indeterminate="indeterminate",i.Paused="paused",i.Error="error"})(It||(It={}));function Ot(){return new Bt(window.__TAURI_INTERNALS__.metadata.currentWindow.label,{skip:!0})}async function dt(){return a("plugin:window|get_all_windows").then(i=>i.map(e=>new Bt(e,{skip:!0})))}const ft=["tauri://created","tauri://error"];class Bt{constructor(e,s={}){var d;this.label=e,this.listeners=Object.create(null),s!=null&&s.skip||a("plugin:window|create",{options:{...s,parent:typeof s.parent=="string"?s.parent:(d=s.parent)===null||d===void 0?void 0:d.label,label:e}}).then(async()=>this.emit("tauri://created")).catch(async p=>this.emit("tauri://error",p))}static async getByLabel(e){var s;return(s=(await dt()).find(d=>d.label===e))!==null&&s!==void 0?s:null}static getCurrent(){return Ot()}static async getAll(){return dt()}static async getFocusedWindow(){for(const e of await dt())if(await e.isFocused())return e;return null}async listen(e,s){return this._handleTauriEvent(e,s)?()=>{const d=this.listeners[e];d.splice(d.indexOf(s),1)}:Ve(e,s,{target:{kind:"Window",label:this.label}})}async once(e,s){return this._handleTauriEvent(e,s)?()=>{const d=this.listeners[e];d.splice(d.indexOf(s),1)}:nn(e,s,{target:{kind:"Window",label:this.label}})}async emit(e,s){if(ft.includes(e)){for(const d of this.listeners[e]||[])d({event:e,id:-1,payload:s});return}return sn(e,s)}async emitTo(e,s,d){if(ft.includes(s)){for(const p of this.listeners[s]||[])p({event:s,id:-1,payload:d});return}return ln(e,s,d)}_handleTauriEvent(e,s){return ft.includes(e)?(e in this.listeners?this.listeners[e].push(s):this.listeners[e]=[s],!0):!1}async scaleFactor(){return a("plugin:window|scale_factor",{label:this.label})}async innerPosition(){return a("plugin:window|inner_position",{label:this.label}).then(e=>new pe(e))}async outerPosition(){return a("plugin:window|outer_position",{label:this.label}).then(e=>new pe(e))}async innerSize(){return a("plugin:window|inner_size",{label:this.label}).then(e=>new Me(e))}async outerSize(){return a("plugin:window|outer_size",{label:this.label}).then(e=>new Me(e))}async isFullscreen(){return a("plugin:window|is_fullscreen",{label:this.label})}async isMinimized(){return a("plugin:window|is_minimized",{label:this.label})}async isMaximized(){return a("plugin:window|is_maximized",{label:this.label})}async isFocused(){return a("plugin:window|is_focused",{label:this.label})}async isDecorated(){return a("plugin:window|is_decorated",{label:this.label})}async isResizable(){return a("plugin:window|is_resizable",{label:this.label})}async isMaximizable(){return a("plugin:window|is_maximizable",{label:this.label})}async isMinimizable(){return a("plugin:window|is_minimizable",{label:this.label})}async isClosable(){return a("plugin:window|is_closable",{label:this.label})}async isVisible(){return a("plugin:window|is_visible",{label:this.label})}async title(){return a("plugin:window|title",{label:this.label})}async theme(){return a("plugin:window|theme",{label:this.label})}async isAlwaysOnTop(){return a("plugin:window|is_always_on_top",{label:this.label})}async center(){return a("plugin:window|center",{label:this.label})}async requestUserAttention(e){let s=null;return e&&(e===pt.Critical?s={type:"Critical"}:s={type:"Informational"}),a("plugin:window|request_user_attention",{label:this.label,value:s})}async setResizable(e){return a("plugin:window|set_resizable",{label:this.label,value:e})}async setEnabled(e){return a("plugin:window|set_enabled",{label:this.label,value:e})}async isEnabled(){return a("plugin:window|is_enabled",{label:this.label})}async setMaximizable(e){return a("plugin:window|set_maximizable",{label:this.label,value:e})}async setMinimizable(e){return a("plugin:window|set_minimizable",{label:this.label,value:e})}async setClosable(e){return a("plugin:window|set_closable",{label:this.label,value:e})}async setTitle(e){return a("plugin:window|set_title",{label:this.label,value:e})}async maximize(){return a("plugin:window|maximize",{label:this.label})}async unmaximize(){return a("plugin:window|unmaximize",{label:this.label})}async toggleMaximize(){return a("plugin:window|toggle_maximize",{label:this.label})}async minimize(){return a("plugin:window|minimize",{label:this.label})}async unminimize(){return a("plugin:window|unminimize",{label:this.label})}async show(){return a("plugin:window|show",{label:this.label})}async hide(){return a("plugin:window|hide",{label:this.label})}async close(){return a("plugin:window|close",{label:this.label})}async destroy(){return a("plugin:window|destroy",{label:this.label})}async setDecorations(e){return a("plugin:window|set_decorations",{label:this.label,value:e})}async setShadow(e){return a("plugin:window|set_shadow",{label:this.label,value:e})}async setEffects(e){return a("plugin:window|set_effects",{label:this.label,value:e})}async clearEffects(){return a("plugin:window|set_effects",{label:this.label,value:null})}async setAlwaysOnTop(e){return a("plugin:window|set_always_on_top",{label:this.label,value:e})}async setAlwaysOnBottom(e){return a("plugin:window|set_always_on_bottom",{label:this.label,value:e})}async setContentProtected(e){return a("plugin:window|set_content_protected",{label:this.label,value:e})}async setSize(e){return a("plugin:window|set_size",{label:this.label,value:e instanceof Ae?e:new Ae(e)})}async setMinSize(e){return a("plugin:window|set_min_size",{label:this.label,value:e instanceof Ae?e:e?new Ae(e):null})}async setMaxSize(e){return a("plugin:window|set_max_size",{label:this.label,value:e instanceof Ae?e:e?new Ae(e):null})}async setSizeConstraints(e){function s(d){return d?{Logical:d}:null}return a("plugin:window|set_size_constraints",{label:this.label,value:{minWidth:s(e==null?void 0:e.minWidth),minHeight:s(e==null?void 0:e.minHeight),maxWidth:s(e==null?void 0:e.maxWidth),maxHeight:s(e==null?void 0:e.maxHeight)}})}async setPosition(e){return a("plugin:window|set_position",{label:this.label,value:e instanceof Ue?e:new Ue(e)})}async setFullscreen(e){return a("plugin:window|set_fullscreen",{label:this.label,value:e})}async setFocus(){return a("plugin:window|set_focus",{label:this.label})}async setIcon(e){return a("plugin:window|set_icon",{label:this.label,value:Ge(e)})}async setSkipTaskbar(e){return a("plugin:window|set_skip_taskbar",{label:this.label,value:e})}async setCursorGrab(e){return a("plugin:window|set_cursor_grab",{label:this.label,value:e})}async setCursorVisible(e){return a("plugin:window|set_cursor_visible",{label:this.label,value:e})}async setCursorIcon(e){return a("plugin:window|set_cursor_icon",{label:this.label,value:e})}async setBackgroundColor(e){return a("plugin:window|set_background_color",{color:e})}async setCursorPosition(e){return a("plugin:window|set_cursor_position",{label:this.label,value:e instanceof Ue?e:new Ue(e)})}async setIgnoreCursorEvents(e){return a("plugin:window|set_ignore_cursor_events",{label:this.label,value:e})}async startDragging(){return a("plugin:window|start_dragging",{label:this.label})}async startResizeDragging(e){return a("plugin:window|start_resize_dragging",{label:this.label,value:e})}async setBadgeCount(e){return a("plugin:window|set_badge_count",{label:this.label,value:e})}async setBadgeLabel(e){return a("plugin:window|set_badge_label",{label:this.label,value:e})}async setOverlayIcon(e){return a("plugin:window|set_overlay_icon",{label:this.label,value:e?Ge(e):void 0})}async setProgressBar(e){return a("plugin:window|set_progress_bar",{label:this.label,value:e})}async setVisibleOnAllWorkspaces(e){return a("plugin:window|set_visible_on_all_workspaces",{label:this.label,value:e})}async setTitleBarStyle(e){return a("plugin:window|set_title_bar_style",{label:this.label,value:e})}async setTheme(e){return a("plugin:window|set_theme",{label:this.label,value:e})}async onResized(e){return this.listen(W.WINDOW_RESIZED,s=>{s.payload=new Me(s.payload),e(s)})}async onMoved(e){return this.listen(W.WINDOW_MOVED,s=>{s.payload=new pe(s.payload),e(s)})}async onCloseRequested(e){return this.listen(W.WINDOW_CLOSE_REQUESTED,async s=>{const d=new an(s);await e(d),d.isPreventDefault()||await this.destroy()})}async onDragDropEvent(e){const s=await this.listen(W.DRAG_ENTER,L=>{e({...L,payload:{type:"enter",paths:L.payload.paths,position:new pe(L.payload.position)}})}),d=await this.listen(W.DRAG_OVER,L=>{e({...L,payload:{type:"over",position:new pe(L.payload.position)}})}),p=await this.listen(W.DRAG_DROP,L=>{e({...L,payload:{type:"drop",paths:L.payload.paths,position:new pe(L.payload.position)}})}),E=await this.listen(W.DRAG_LEAVE,L=>{e({...L,payload:{type:"leave"}})});return()=>{s(),p(),d(),E()}}async onFocusChanged(e){const s=await this.listen(W.WINDOW_FOCUS,p=>{e({...p,payload:!0})}),d=await this.listen(W.WINDOW_BLUR,p=>{e({...p,payload:!1})});return()=>{s(),d()}}async onScaleChanged(e){return this.listen(W.WINDOW_SCALE_FACTOR_CHANGED,e)}async onThemeChanged(e){return this.listen(W.WINDOW_THEME_CHANGED,e)}}var St;(function(i){i.Disabled="disabled",i.Throttle="throttle",i.Suspend="suspend"})(St||(St={}));var Dt;(function(i){i.AppearanceBased="appearanceBased",i.Light="light",i.Dark="dark",i.MediumLight="mediumLight",i.UltraDark="ultraDark",i.Titlebar="titlebar",i.Selection="selection",i.Menu="menu",i.Popover="popover",i.Sidebar="sidebar",i.HeaderView="headerView",i.Sheet="sheet",i.WindowBackground="windowBackground",i.HudWindow="hudWindow",i.FullScreenUI="fullScreenUI",i.Tooltip="tooltip",i.ContentBackground="contentBackground",i.UnderWindowBackground="underWindowBackground",i.UnderPageBackground="underPageBackground",i.Mica="mica",i.Blur="blur",i.Acrylic="acrylic",i.Tabbed="tabbed",i.TabbedDark="tabbedDark",i.TabbedLight="tabbedLight"})(Dt||(Dt={}));var At;(function(i){i.FollowsWindowActiveState="followsWindowActiveState",i.Active="active",i.Inactive="inactive"})(At||(At={}));class Ke extends kt{constructor(e){super(e)}static async load(e,s){const d=await a("plugin:store|load",{path:e,...s});return new Ke(d)}static async get(e){return await a("plugin:store|get_store",{path:e}).then(s=>s?new Ke(s):null)}async set(e,s){await a("plugin:store|set",{rid:this.rid,key:e,value:s})}async get(e){const[s,d]=await a("plugin:store|get",{rid:this.rid,key:e});return d?s:void 0}async has(e){return await a("plugin:store|has",{rid:this.rid,key:e})}async delete(e){return await a("plugin:store|delete",{rid:this.rid,key:e})}async clear(){await a("plugin:store|clear",{rid:this.rid})}async reset(){await a("plugin:store|reset",{rid:this.rid})}async keys(){return await a("plugin:store|keys",{rid:this.rid})}async values(){return await a("plugin:store|values",{rid:this.rid})}async entries(){return await a("plugin:store|entries",{rid:this.rid})}async length(){return await a("plugin:store|length",{rid:this.rid})}async reload(){await a("plugin:store|reload",{rid:this.rid})}async save(){await a("plugin:store|save",{rid:this.rid})}async onKeyChange(e,s){return await Ve("store://change",d=>{d.payload.resourceId===this.rid&&d.payload.key===e&&s(d.payload.exists?d.payload.value:void 0)})}async onChange(e){return await Ve("store://change",s=>{s.payload.resourceId===this.rid&&e(s.payload.key,s.payload.exists?s.payload.value:void 0)})}}async function rn(){await a("plugin:autostart|enable")}async function on(){await a("plugin:autostart|disable")}const qe=Ot(),g=new Ke(".torn-widget-settings.dat");(async function(){const i="1.0.37",e="https://www.torn.com/forums.php#/p=threads&f=67&t=16473214&b=0&a=0",s="GNSC4 [268863]",d="https://www.torn.com/profiles.php?XID=268863",p="https://api.github.com/repos/gnsc4/Torn-Widget/releases/latest",E="https://github.com/gnsc4/Torn-Widget/releases",ke="torn_status_api_key_v1_widget",ht="torn_status_gui_minimized_v1_widget",je="torn_autostart_preference_v1_widget",Ye="torn_always_on_top_preference_v1_widget",gt="torn_link_type_v1_widget_",mt="torn_tos_accepted_v1_widget";let x,A,j,c={update:null,energy:null,nerve:null,happiness:null,booster:null,medical:null,drug:null,newDay:null,travel:null,race:null,travelEndFlashTimeout:null,raceEndFlashTimeout:null},f,$,F,ye,he,ge,me,v,Q,_,we,be,ve,T,U,C,ee,V,te,q,O,xe,Re,B,M,de,Y,J,X,Z,Je,Xe,G,b,Ze,k,_e,P,Qe,w,et,I,ne,S,N,Ie,Pe,Se,ie,Te,m,se,tt,nt,le,Ce,Ee,it,z,Le,ze=48*3600,st=6*3600,ae=null,R=null;const lt='<svg viewBox="0 0 24 24" fill="currentColor" width="16px" height="16px"><path d="M0 0h24v24H0z" fill="none"/><path d="M20 4H4c-1.1 0-1.99.9-1.99 2L2 18c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2zm0 4l-8 5-8-5V6l8 5 8-5v2z"/></svg>',at='<svg viewBox="0 0 24 24" fill="currentColor" width="16px" height="16px"><path d="M0 0h24v24H0z" fill="none"/><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 15h-2v-2h2v2zm0-4h-2V7h2v6z"/></svg>',We={drug:{personal:"https://www.torn.com/item.php#drugs-items",faction:"https://www.torn.com/factions.php?step=your&type=1#/tab=armoury&start=0&sub=drugs",elementId:"drug-cooldown-link",toggleId:"drug-link-type-toggle",personalLabelId:"drug-personal-label",factionLabelId:"drug-faction-label"},booster:{personal:"https://www.torn.com/item.php#energy-d-items",faction:"https://www.torn.com/factions.php?step=your&type=1#/tab=armoury&start=0&sub=boosters",elementId:"booster-cooldown-link",toggleId:"booster-link-type-toggle",personalLabelId:"booster-personal-label",factionLabelId:"booster-faction-label"},medical:{personal:"https://www.torn.com/item.php#medical-items",faction:"https://www.torn.com/factions.php?step=your&type=1#/tab=armoury&start=0&sub=medical",elementIds:["medical-cooldown-link","life-link"],toggleId:"medical-link-type-toggle",personalLabelId:"medical-personal-label",factionLabelId:"medical-faction-label"},energyRefill:{personal:"https://www.torn.com/page.php?sid=points",faction:"https://www.torn.com/factions.php?step=your&type=1#/tab=armoury&start=0&sub=points",elementId:"energy-refill-link",toggleId:"energyRefill-link-type-toggle",personalLabelId:"energyRefill-personal-label",factionLabelId:"energyRefill-faction-label"},nerveRefill:{personal:"https://www.torn.com/page.php?sid=points",faction:"https://www.torn.com/factions.php?step=your&type=1#/tab=armoury&start=0&sub=points",elementId:"nerve-refill-link",toggleId:"nerveRefill-link-type-toggle",personalLabelId:"nerveRefill-personal-label",factionLabelId:"nerveRefill-faction-label"}};let rt={},ot={};async function wt(){try{await rn(),console.log("Autostart enabled via plugin.")}catch(n){console.error("Failed to enable autostart via plugin:",n)}}async function Mt(){try{await on(),console.log("Autostart disabled via plugin.")}catch(n){console.error("Failed to disable autostart via plugin:",n)}}async function re(){if(!f||!xe||!document.getElementById("torn-status-header"))return;const n=f.style.display==="none";n&&(f.style.visibility="hidden",f.style.display="block"),f.offsetHeight;const r=document.getElementById("torn-status-header");let t=0;if(t+=r.offsetHeight,t+=parseInt(getComputedStyle(r).marginBottom)||0,m&&m.style.display==="flex"){t+=m.offsetHeight;const u=getComputedStyle(m);t+=(parseInt(u.paddingTop)||0)+(parseInt(u.paddingBottom)||0)}else{let u=0;const h=[V,O,b,w,te,q,ie];let y=!0,ce=0;for(const ue of h)if(ue&&getComputedStyle(ue).display!=="none"){const Lt=getComputedStyle(ue),xt=parseInt(Lt.marginTop)||0;y?u+=xt:u+=Math.max(ce,xt),u+=ue.offsetHeight,ce=parseInt(Lt.marginBottom)||0,y=!1}y||(u+=ce),t+=u}t+=parseInt(getComputedStyle(xe).marginTop)||0,t+=xe.offsetHeight;const l=getComputedStyle(f),o=t+(parseInt(l.paddingTop)||0)+(parseInt(l.paddingBottom)||0)+(parseInt(l.borderTopWidth)||0)+(parseInt(l.borderBottomWidth)||0)+(m&&m.style.display==="flex"?0:10);n&&(f.style.display="none",f.style.visibility="visible"),requestAnimationFrame(async()=>{try{const u=f.offsetWidth;o>0&&u>0&&await qe.setSize(new yt(Math.ceil(u),Math.ceil(o)))}catch(u){console.error("Error resizing window (RAF):",u)}})}function D(n){if(isNaN(n)||n<0)return"--:--:--";const r=Math.floor(n/3600),t=Math.floor(n%3600/60),l=Math.floor(n%60);return`${String(r).padStart(2,"0")}:${String(t).padStart(2,"0")}:${String(l).padStart(2,"0")}`}function Nt(){if(f=document.getElementById("torn-status-gui"),$=document.getElementById("torn-status-minimize-btn"),Je=document.getElementById("torn-status-close-btn"),Xe=document.getElementById("torn-status-settings-btn"),F=document.getElementById("custom-tooltip"),xe=document.getElementById("widget-version"),Re=document.getElementById("update-notification"),V=document.getElementById("torn-status-api-setup"),Ie=document.getElementById("torn-api-key-input-main"),Pe=document.getElementById("torn-api-key-save-btn-main"),Se=V.querySelector(".api-error-main"),z=document.getElementById("tos-section"),Le=document.getElementById("tos-checkbox"),ie=document.getElementById("first-run-autostart-option"),Te=document.getElementById("first-run-autostart-checkbox"),m=document.getElementById("torn-status-settings-panel"),se=document.getElementById("torn-api-key-input-settings"),tt=document.getElementById("torn-api-key-save-btn-settings"),nt=document.getElementById("torn-api-key-clear-btn-settings"),le=m.querySelector(".api-error-settings"),Ce=document.getElementById("settings-autostart-checkbox"),Ee=document.getElementById("settings-always-on-top-checkbox"),it=document.getElementById("settings-panel-close-btn"),b=document.getElementById("torn-travel-status"),Ze=document.getElementById("travel-link"),Ze&&(k=Ze.querySelector("span:first-child")),_e=b.querySelector(".travel-destination-value"),P=b.querySelector(".travel-timer"),Qe=b.querySelector(".travel-error"),w=document.getElementById("torn-race-status"),et=document.getElementById("race-link"),et&&(I=et.querySelector("span:first-child")),ne=w.querySelector(".race-info-value"),S=w.querySelector(".race-timer"),N=w.querySelector(".race-error"),!f)return;xe&&(xe.innerHTML=`Author: <a href="${d}" target="_blank" title="View Author's Profile">${s}</a> | <a href="${e}" target="_blank" title="Go to Forum Thread">v${i}</a><span id="update-notification" style="display:none;"> <a href="#" target="_blank">New version available!</a></span>`,Re=document.getElementById("update-notification")),A?(f.classList.add("minimized"),$&&($.textContent="□",$.title="Maximize")):(f.classList.remove("minimized"),$&&($.textContent="−",$.title="Minimize")),ye=f.querySelector(".life-value-overlay"),G=f.querySelector(".health-bar-fill"),he=f.querySelector(".energy-value"),ge=f.querySelector(".nerve-value"),me=f.querySelector(".happy-value"),v=f.querySelector(".booster-value"),Q=f.querySelector(".medical-value"),_=f.querySelector(".drug-value"),we=f.querySelector(".energy-timer"),be=f.querySelector(".nerve-timer"),ve=f.querySelector(".happy-timer"),T=f.querySelector(".booster-timer"),U=f.querySelector(".medical-timer"),C=f.querySelector(".drug-timer"),ee=f.querySelector(".new-day-timer-value"),O=document.getElementById("torn-status-notifications"),te=document.getElementById("torn-status-content"),q=document.getElementById("torn-status-refills"),Y=O.querySelector(".messages-icon"),J=O.querySelector(".messages-count"),X=O.querySelector(".events-icon"),Z=O.querySelector(".events-count"),B=q.querySelector(".energy-refill-status"),M=q.querySelector(".nerve-refill-status"),de=q.querySelector(".token-refill-status");for(const t in We){const l=We[t];l.elementId?rt[t]=document.getElementById(l.elementId):l.elementIds&&(rt[t]=l.elementIds.map(o=>document.getElementById(o))),ot[t]={input:document.getElementById(l.toggleId),personalLabel:document.getElementById(l.personalLabelId),factionLabel:document.getElementById(l.factionLabelId)}}$&&$.addEventListener("click",Ct),Je&&Je.addEventListener("click",async()=>{await qe.close()}),Xe&&Xe.addEventListener("click",ct),it&&it.addEventListener("click",ct),Pe&&Pe.addEventListener("click",()=>ut(Ie,Se)),Ie&&Ie.addEventListener("input",Oe),Le&&Le.addEventListener("change",Oe),tt&&tt.addEventListener("click",()=>ut(se,le,!0)),se&&se.addEventListener("keypress",t=>{t.key==="Enter"&&ut(se,le,!0)}),nt&&nt.addEventListener("click",Jt),Te&&Te.addEventListener("change",bt),Ce&&Ce.addEventListener("change",bt),Ee&&Ee.addEventListener("change",zt);const n=document.getElementById("torn-status-header");n&&n.addEventListener("click",t=>{A&&f.classList.contains("minimized")&&t.target===n&&Ct()}),f.querySelectorAll(".timer-hover-area").forEach(t=>{t.addEventListener("mouseover",qt),t.addEventListener("mouseout",Ht),t.addEventListener("mousemove",Vt)})}function Oe(){if(!Pe||!Ie||!Le)return;const n=/^[a-zA-Z0-9]{16}$/.test(Ie.value.trim());Pe.disabled=!(n&&Le.checked)}function ct(){if(!m)return;const n=m.style.display==="flex";m.style.display=n?"none":"flex",n||(se&&(se.value=""),le&&(le.textContent="")),re()}async function bt(n){const r=n.target.checked;await g.set(je,r.toString()),await g.save(),r?await wt():await Mt(),Te&&(Te.checked=r),Ce&&(Ce.checked=r)}async function zt(n){const r=n.target.checked;await g.set(Ye,r.toString()),await g.save();try{await qe.setAlwaysOnTop(r),console.log(`Always on Top ${r?"enabled":"disabled"}`)}catch(t){console.error("Failed to set always on top:",t)}Ee&&(Ee.checked=r)}async function Wt(){let n=await g.get(je),r=!1;n===null?(r=!0,await g.set(je,"true"),await g.save(),n="true"):r=n==="true",r&&await wt();const t=n==="true";Te&&(Te.checked=t),Ce&&(Ce.checked=t)}async function $t(){let n=await g.get(Ye),r=!0;n===null?(await g.set(Ye,"true"),await g.save()):r=n==="true";try{await qe.setAlwaysOnTop(r),console.log(`Initial Always on Top set to: ${r}`)}catch(t){console.error("Failed to set initial always on top state:",t)}Ee&&(Ee.checked=r)}function Ft(n,r){const t=ot[n];t&&t.personalLabel&&t.factionLabel&&(t.personalLabel.classList.toggle("active-preference",!r),t.factionLabel.classList.toggle("active-preference",r))}async function vt(n,r){const t=We[n],l=rt[n];if(!t||!l){console.warn(`No URL details or target element for ${n}`);return}const o=r?t.faction:t.personal;Array.isArray(l)?l.forEach(u=>{u&&(u.href=o)}):l&&(l.href=o),Ft(n,r)}async function Ut(){for(const n of Object.keys(We)){const r=ot[n];if(!r||!r.input){console.warn(`Toggle input not found for ${n}`);continue}const l=await g.get(gt+n)==="faction";r.input.checked=l,await vt(n,l),r.input.addEventListener("change",async o=>{const u=o.target.checked;await g.set(gt+n,u?"faction":"personal"),await g.save(),await vt(n,u)})}}function qt(n){const t=n.currentTarget.querySelector(".timer");F&&t&&t.dataset.tooltipContent&&(F.innerHTML=t.dataset.tooltipContent,F.style.display="block",_t(n.pageX,n.pageY))}function Ht(){F&&(F.style.display="none")}function Vt(n){F&&F.style.display==="block"&&_t(n.pageX,n.pageY)}function _t(n,r){if(!F)return;const t=10,l=15;let o=n+t,u=r+l;const h=F.getBoundingClientRect(),y=window.innerWidth||document.documentElement.clientWidth,ce=window.innerHeight||document.documentElement.clientHeight;o+h.width>y&&(o=n-h.width-t),u+h.height>ce&&(u=r-h.height-l),o<0&&(o=0),u<0&&(u=0),F.style.left=`${o}px`,F.style.top=`${u}px`}async function $e(){if(!x){oe({error:"API Key needed",target:"api_main",isTransient:!1}),K(!1),c.update&&(clearInterval(c.update),c.update=null),Be();return}const n=`https://api.torn.com/user/?selections=bars,cooldowns,refills,personalstats,notifications,travel&key=${x}&comment=TornStatusWidget_v${i}`,r=new AbortController,t=setTimeout(()=>r.abort(),1e4);try{const l=await fetch(n,{method:"GET",signal:r.signal});if(clearTimeout(t),l.ok){const o=await l.json();if(o.error)if(o.error.code===2){x=null,await g.delete(ke),await g.save(),c.update&&(clearInterval(c.update),c.update=null),Be(),oe({error:`API Error ${o.error.code}`,target:"api_main",isTransient:!1}),K(!1);return}else oe({error:`API Error ${o.error.code}`,target:"status",isTransient:!0});else ae=o,oe(ae),Kt(ae),Tt("primary")}else{let o;try{o=await l.json()}catch{throw new Error(`HTTP error ${l.status}`)}if(o&&o.error){const u=`API Error ${o.error.code}`;if(o.error.code===2){x=null,await g.delete(ke),await g.save(),c.update&&(clearInterval(c.update),c.update=null),Be(),oe({error:u,target:"api_main",isTransient:!1}),K(!1);return}else oe({error:u,target:"status",isTransient:!0})}else oe({error:`HTTP error ${l.status}`,target:"status",isTransient:!0})}}catch(l){clearTimeout(t);const o=l.name==="AbortError"?"Timeout (User Data)":"Network Error (User Data)";oe({error:o,target:"status",isTransient:!0})}if(x){const l=`https://api.torn.com/v2/user/races?limit=1&sort=DESC&key=${x}&comment=TornStatusWidget_v${i}`,o=new AbortController,u=setTimeout(()=>o.abort(),1e4);try{const h=await fetch(l,{method:"GET",signal:o.signal});if(clearTimeout(u),h.ok){const y=await h.json();y.error?(N&&(N.textContent=`Race API Err: ${y.error.code}`),R?(fe(R),Fe(R)):fe(null)):(N&&(N.textContent=""),R=y,fe(R),Fe(R))}else{let y;try{y=await h.json()}catch{}const ce=y&&y.error?y.error.code:h.status;N&&(N.textContent=`Race API Err: ${ce}`),R?(fe(R),Fe(R)):fe(null)}}catch(h){clearTimeout(u),N&&(N.textContent=h.name==="AbortError"?"Race Timeout":"Race Net Err"),R?(fe(R),Fe(R)):fe(null)}}else fe(null);!A&&!(m&&m.style.display==="flex")&&K(!!(x&&j)),re()}function oe(n){const r=f.querySelector(".status-error");if(n.error&&!n.isTransient){if(m&&m.style.display,n.target==="api_main"&&Se?Se.textContent=`Error: ${n.error}`:n.target==="api_settings"&&le?le.textContent=`Error: ${n.error}`:r&&(r.textContent=`Error: ${n.error}`),n.target==="api_main"||n.target==="api_settings")return}else n.error&&n.isTransient&&r&&(r.textContent=`Error: ${n.error}`);const t=n.error?ae:n;if(!t){Qe&&!n.error&&(Qe.textContent=""),N&&!n.error&&(N.textContent="");return}if(!n.error){const l=m&&m.style.display==="flex"?le:Se;l&&(l.textContent=""),r&&(r.textContent="")}if(Gt(t.travel),t.personalstats&&typeof t.personalstats.boosters_max_cooldown_hours=="number"&&(ze=t.personalstats.boosters_max_cooldown_hours*3600),t.notifications){const l=t.notifications.messages||0,o=t.notifications.events||0;Y&&(Y.innerHTML=lt),J&&(J.textContent=l,Y.className=l>0?"notification-icon messages-icon red":"notification-icon messages-icon green",J.className=l>0?"notification-count messages-count red":"notification-count messages-count green"),X&&(X.innerHTML=at),Z&&(Z.textContent=o,X.className=o>0?"notification-icon events-icon red":"notification-icon events-icon green",Z.className=o>0?"notification-count events-count red":"notification-count events-count green")}else Y&&(Y.innerHTML=lt),J&&(J.textContent="N/A",Y.className="notification-icon messages-icon green",J.className="notification-count messages-count green"),X&&(X.innerHTML=at),Z&&(Z.textContent="N/A",X.className="notification-icon events-icon green",Z.className="notification-count events-count green");if(ye&&t.life&&typeof t.life.current<"u"&&typeof t.life.maximum<"u"&&t.life.maximum>0){if(ye.textContent=`${t.life.current}/${t.life.maximum}`,G){const l=t.life.current/t.life.maximum*100;G.style.width=`${Math.max(0,Math.min(100,l))}%`,l<=25?G.style.backgroundColor="#dc3545":l<=50?G.style.backgroundColor="#ffc107":G.style.backgroundColor="#28a745"}}else ye&&(ye.textContent="N/A",G&&(G.style.width="0%",G.style.backgroundColor="#444"));he&&t.energy&&typeof t.energy.current<"u"?he.textContent=`${t.energy.current}/${t.energy.maximum}`:he&&(he.textContent="N/A"),ge&&t.nerve&&typeof t.nerve.current<"u"?ge.textContent=`${t.nerve.current}/${t.nerve.maximum}`:ge&&(ge.textContent="N/A"),me&&t.happy&&typeof t.happy.current<"u"?me.textContent=`${t.happy.current}/${t.happy.maximum}`:me&&(me.textContent="N/A"),t.cooldowns?(v&&(v.textContent=t.cooldowns.booster>0?"Active":"Ready",t.cooldowns.booster===0?(v.classList.add("flashing"),T&&T.classList.add("flashing")):(v.classList.remove("flashing"),T&&T.classList.remove("flashing"))),Q&&(Q.textContent=t.cooldowns.medical>0?"Active":"Ready"),_&&(_.textContent=t.cooldowns.drug>0?"Active":"Ready",t.cooldowns.drug===0?(_.classList.add("flashing"),C&&C.classList.add("flashing")):(_.classList.remove("flashing"),C&&C.classList.remove("flashing")))):(v&&(v.textContent="N/A",v.classList.remove("flashing"),T&&T.classList.remove("flashing")),Q&&(Q.textContent="N/A"),_&&(_.textContent="N/A",_.classList.remove("flashing"),C&&C.classList.remove("flashing"))),t.refills?(B&&(B.textContent=t.refills.energy_refill_used?"Used":"Ready",B.className=t.refills.energy_refill_used?"refill-status used":"refill-status ready"),M&&(M.textContent=t.refills.nerve_refill_used?"Used":"Ready",M.className=t.refills.nerve_refill_used?"refill-status used":"refill-status ready"),de&&(de.textContent=t.refills.token_refill_used?"Used":"Ready",de.className=t.refills.token_refill_used?"refill-status used":"refill-status ready")):(B&&(B.textContent="N/A"),M&&(M.textContent="N/A"),de&&(de.textContent="N/A"))}function Gt(n){if(!b||!k||!_e||!P)return;const r=n||(ae?ae.travel:null);c.travelEndFlashTimeout&&(clearTimeout(c.travelEndFlashTimeout),c.travelEndFlashTimeout=null),k.classList.remove("label-flash-red"),r&&r.time_left>0?(b.style.display="block",_e.textContent=r.destination||"Unknown",P.textContent=D(r.time_left),P.dataset.tooltipContent=`Arriving in ${r.destination||"Unknown"}`,P.classList.remove("soon")):(k.classList.contains("label-flash-red")||(b.style.display="none"),c.travel&&(clearTimeout(c.travel),c.travel=null))}function fe(n){if(!w||!I||!ne||!S)return;const r=Math.floor(Date.now()/1e3),t=n||R;if(c.raceEndFlashTimeout&&(clearTimeout(c.raceEndFlashTimeout),c.raceEndFlashTimeout=null),I.classList.remove("label-flash-red"),t&&t.races&&t.races.length>0){const l=t.races[0];if(l.status==="starting"||l.status==="active"||l.status==="in_progress"||l.status==="scheduled"&&l.schedule.start>r){w.style.display="block";let o=`Track: ${l.track_id}`,u="--:--:--",h=`Race: ${l.title}`;if(S.classList.remove("soon"),l.status==="starting"||l.status==="scheduled"&&l.schedule.start>r){const y=l.schedule.start-r;y>0?(u=D(y),o="Starts in:",h+=`
Starts: ${new Date(l.schedule.start*1e3).toLocaleTimeString()}`):(o=l.status==="in_progress"?"In Progress":"Active",u="Ongoing",h+=`
Status: ${l.status}`)}else if(l.status==="active"||l.status==="in_progress"){o=l.status==="in_progress"?"In Progress":"Active";const y=l.schedule.end-r;u=y>0?D(y):"Ending soon",h+=`
Ends: ${new Date(l.schedule.end*1e3).toLocaleTimeString()}`}ne.textContent=o,S.textContent=u,S.dataset.tooltipContent=h;return}}I.classList.contains("label-flash-red")||(w.style.display="none"),c.race&&(clearTimeout(c.race),c.race=null)}function Kt(n){["energy","nerve","happiness","booster","medical","drug","newDay"].forEach(t=>{c[t]&&(t==="newDay"?clearInterval(c[t]):clearTimeout(c[t]),c[t]=null)}),n.energy&&typeof n.energy.fulltime<"u"&&we?De("energy",n.energy.fulltime,we,0):we&&(we.textContent="N/A",we.classList.remove("full")),n.nerve&&typeof n.nerve.fulltime<"u"&&be?De("nerve",n.nerve.fulltime,be,0):be&&(be.textContent="N/A",be.classList.remove("full")),n.happy&&typeof n.happy.fulltime<"u"&&ve?De("happiness",n.happy.fulltime,ve,0):ve&&(ve.textContent="N/A",ve.classList.remove("full")),n.cooldowns&&(typeof n.cooldowns.booster<"u"&&T?n.cooldowns.booster>0?De("booster",n.cooldowns.booster,T,ze):(T.textContent=D(ze),T.classList.add("full","flashing"),v&&v.classList.add("flashing"),T.dataset.tooltipContent=`Ready
Max Duration: ${D(ze)}`):T&&(T.textContent="N/A",T.classList.remove("full","flashing"),v&&v.classList.remove("flashing"),T.dataset.tooltipContent="Booster: N/A"),typeof n.cooldowns.medical<"u"&&U?n.cooldowns.medical>0?De("medical",n.cooldowns.medical,U,st):(U.textContent=D(st),U.classList.add("full"),U.dataset.tooltipContent=`Ready
Max Duration: ${D(st)}`):U&&(U.textContent="N/A",U.classList.remove("full","flashing"),U.dataset.tooltipContent="Medical: N/A"),typeof n.cooldowns.drug<"u"&&C?n.cooldowns.drug>0?De("drug",n.cooldowns.drug,C,0):(C.textContent="Ready",C.classList.add("full","flashing"),_&&_.classList.add("flashing"),C.dataset.tooltipContent="Ready"):C&&(C.textContent="N/A",C.classList.remove("full","flashing"),_&&_.classList.remove("flashing"),C.dataset.tooltipContent="Drug: N/A")),Yt(),jt(n.travel)}function jt(n){c.travel&&clearTimeout(c.travel),c.travelEndFlashTimeout&&(clearTimeout(c.travelEndFlashTimeout),c.travelEndFlashTimeout=null,k&&k.classList.remove("label-flash-red"));const r=n||(ae?ae.travel:null);if(!P||!r||r.time_left<=0){b&&!(k&&k.classList.contains("label-flash-red"))&&(b.style.display="none");return}let t=r.time_left;b.style.display="block",k&&k.classList.remove("label-flash-red");function l(){if(t<=0)P.textContent="Arrived!",P.classList.remove("soon"),_e.textContent=r.destination||"Destination",k&&k.classList.add("label-flash-red"),c.travel=null,c.travelEndFlashTimeout&&clearTimeout(c.travelEndFlashTimeout),c.travelEndFlashTimeout=setTimeout(()=>{k&&k.classList.remove("label-flash-red"),b&&(b.style.display="none"),re()},1e4);else{P.textContent=D(t),_e.textContent=r.destination||"Destination";const o=r.timestamp+(r.time_total-t),u=new Date(o*1e3);P.dataset.tooltipContent=`Arriving in ${r.destination||"Unknown"} at ${u.toLocaleTimeString()}`,t<=60?P.classList.add("soon"):P.classList.remove("soon"),t--,c.travel=setTimeout(l,1e3)}}l()}function Fe(n){c.race&&clearTimeout(c.race),c.raceEndFlashTimeout&&(clearTimeout(c.raceEndFlashTimeout),c.raceEndFlashTimeout=null,I&&I.classList.remove("label-flash-red"));const r=n||R;if(!S||!r||!r.races||r.races.length===0){w&&!(I&&I.classList.contains("label-flash-red"))&&(w.style.display="none");return}const t=r.races[0],l=Math.floor(Date.now()/1e3);let o=0,u="none";if(t.status==="starting"||t.status==="scheduled"&&t.schedule.start>l?(o=t.schedule.start-l,u="starting"):(t.status==="active"||t.status==="in_progress")&&(o=t.schedule.end-l,u="active_ending"),u==="none"||o<0){w&&!(I&&I.classList.contains("label-flash-red"))&&(w.style.display="none");return}w.style.display="block",I&&I.classList.remove("label-flash-red");function h(){if(o<=0){c.race=null,u==="starting"?(ne.textContent=t.status==="in_progress"?"In Progress":"Active",S.textContent="Ongoing",S.dataset.tooltipContent=`Race: ${t.title}
Status: ${t.status}`):u==="active_ending"&&(ne.textContent="Finished!",S.textContent="--:--:--",S.dataset.tooltipContent=`Race: ${t.title}
Status: Finished`,I&&I.classList.add("label-flash-red"),c.raceEndFlashTimeout&&clearTimeout(c.raceEndFlashTimeout),c.raceEndFlashTimeout=setTimeout(()=>{I&&I.classList.remove("label-flash-red"),w&&(w.style.display="none"),re()},1e4));return}S.textContent=D(o),u==="starting"?(ne.textContent="Starts in:",S.dataset.tooltipContent=`Race: ${t.title}
Starts at: ${new Date(t.schedule.start*1e3).toLocaleTimeString()}`):u==="active_ending"&&(ne.textContent="Ends in:",S.dataset.tooltipContent=`Race: ${t.title}
Ends at: ${new Date(t.schedule.end*1e3).toLocaleTimeString()}`),o<=60?S.classList.add("soon"):S.classList.remove("soon"),o--,c.race=setTimeout(h,1e3)}h()}function Yt(){if(c.newDay&&clearInterval(c.newDay),!ee)return;function n(){const r=new Date,t=new Date(Date.UTC(r.getUTCFullYear(),r.getUTCMonth(),r.getUTCDate()+1,0,0,0,0)),l=Math.floor((t.getTime()-r.getTime())/1e3),o=l<3600&&l>=0;o?ee.classList.add("new-day-warning"):ee.classList.remove("new-day-warning"),ee.textContent=D(l>=0?l:0);let u=!1;B&&(o&&B.textContent==="Ready"?(B.classList.add("flashing"),u=!0):B.classList.remove("flashing")),M&&(o&&M.textContent==="Ready"?(M.classList.add("flashing"),u=!0):M.classList.remove("flashing")),u&&o?ee.classList.add("flashing"):ee.classList.remove("flashing")}n(),c.newDay=setInterval(n,1e3)}function De(n,r,t,l){if(!t)return;c[n]&&clearTimeout(c[n]);let o=Number(r);if(isNaN(o)){t.textContent="Error",t.classList.remove("full","flashing"),n==="booster"&&v&&v.classList.remove("flashing"),n==="drug"&&_&&_.classList.remove("flashing"),t.dataset.tooltipContent="Error",c[n]=null;return}let u=null;n==="booster"?u=v:n==="medical"?u=Q:n==="drug"&&(u=_);function h(){let y="";const ce=Date.now();if(o<=0)t.classList.add("full"),c[n]=null,(n==="booster"||n==="medical"||n==="drug")&&(u&&(u.textContent="Ready"),(n==="booster"||n==="drug")&&(u&&u.classList.add("flashing"),t.classList.add("flashing"))),(n==="booster"||n==="medical")&&l>0?(t.textContent=D(l),y=`Ready
Max Duration: ${D(l)}`):n==="drug"?(t.textContent="Ready",y="Ready"):(t.textContent="Full",y="Full"),t.dataset.tooltipContent=y;else{t.classList.remove("full","flashing"),u&&u.classList.remove("flashing"),u&&(n==="booster"||n==="medical"||n==="drug")&&(u.textContent="Active");const ue=new Date(ce+o*1e3).toLocaleString([],{dateStyle:"short",timeStyle:"medium"});(n==="booster"||n==="medical")&&l>0?(t.textContent=D(o),y=`Ends: ${ue}
Remaining: ${D(o)}`):n==="drug"?(t.textContent=D(o),y=`Ends: ${ue}
(Drug active)`):(t.textContent=D(o),y=`Full at: ${ue}`),t.dataset.tooltipContent=y,o--,c[n]=setTimeout(h,1e3)}}h()}function Be(){Object.keys(c).forEach(t=>{c[t]&&(t==="update"||t==="newDay"?clearInterval(c[t]):clearTimeout(c[t]),c[t]=null)}),ae=null,R=null,[B,M,ee,v,T,_,C,Q,U,P,S,k,I].forEach(t=>{t&&t.classList.remove("flashing","new-day-warning","soon","label-flash-red")}),[we,be,ve,T,U,C,ee,P,S].forEach(t=>{t&&(t.textContent="--:--:--",t.classList&&t.classList.remove("full"),t.dataset&&(t.dataset.tooltipContent=""))}),ye&&(ye.textContent="--/--"),G&&(G.style.width="0%"),he&&(he.textContent="--/--"),ge&&(ge.textContent="--/--"),me&&(me.textContent="--/--"),v&&(v.textContent="--"),Q&&(Q.textContent="--"),_&&(_.textContent="--"),Y&&(Y.innerHTML=lt),J&&(J.textContent="--",Y.className="notification-icon messages-icon green",J.className="notification-count messages-count green"),X&&(X.innerHTML=at),Z&&(Z.textContent="--",X.className="notification-icon events-icon green",Z.className="notification-count events-count green"),B&&(B.textContent="--"),M&&(M.textContent="--"),de&&(de.textContent="--"),_e&&(_e.textContent="--"),ne&&(ne.textContent="--"),b&&(b.style.display="none"),w&&(w.style.display="none")}function Tt(n="all"){if(n==="all"||n==="primary"){const r=V.querySelector(".api-error-main"),t=m.querySelector(".api-error-settings"),l=f.querySelector(".status-error");r&&(r.textContent=""),t&&(t.textContent=""),l&&(l.textContent="")}(n==="all"||n==="race")&&N&&(N.textContent="")}async function Ct(){A=!A,f&&f.classList.toggle("minimized",A),$&&($.textContent=A?"□":"−",$.title=A?"Maximize":"Minimize"),await g.set(ht,A.toString()),await g.save(),!A&&m&&m.style.display==="flex"&&(m.style.display="none",re(),m.style.display="flex"),re(),!A&&x&&j?K(!0):!A&&(!x||!j)&&K(!1)}async function ut(n,r,t=!1){if(!n||!r)return;const l=n.value.trim();if(!t&&Le&&!Le.checked){r.textContent="Please accept the Terms of Service.";return}l&&/^[a-zA-Z0-9]{16}$/.test(l)?(x=l,await g.set(ke,x),t||(await g.set(mt,"true"),j=!0),await g.save(),z&&(z.style.display="none"),n.value="",Tt(),K(!0),c.update&&clearInterval(c.update),$e(),c.update=setInterval($e,15e3),t&&ct()):r.textContent="Invalid Key format (16 letters/numbers)",t||Oe()}async function Jt(){x=null,await g.delete(ke),await g.save(),c.update&&(clearInterval(c.update),c.update=null),Be(),oe({error:"API Key cleared. Enter a new key.",target:"api_settings",isTransient:!1}),K(!1),se&&(se.value="")}function K(n){!V||!O||!te||!q||!f||!ie||!b||!w||!z||(n&&x&&j?(O.style.setProperty("display","flex","important"),te.style.setProperty("display","block","important"),q.style.setProperty("display","block","important"),V.style.setProperty("display","none","important"),ie.style.display="none",z.style.display="none"):(V.style.setProperty("display","block","important"),O.style.setProperty("display","none","important"),te.style.setProperty("display","none","important"),q.style.setProperty("display","none","important"),b.style.setProperty("display","none","important"),w.style.setProperty("display","none","important"),j?z.style.display="none":z.style.display="block",ie.style.display=!x&&j?"block":"none",Oe()))}function Xt(n,r){const t=n.replace(/^v/,"").split(".").map(Number),l=r.replace(/^v/,"").split(".").map(Number);for(let o=0;o<Math.max(t.length,l.length);o++){const u=t[o]||0,h=l[o]||0;if(u>h)return!0;if(u<h)return!1}return!1}async function Zt(){try{const n=await fetch(p);if(!n.ok){console.error(`GitHub API error: ${n.status}`);return}const t=(await n.json()).tag_name;if(t&&Xt(t,i)&&Re){const l=Re.querySelector("a");l&&(l.href=E,l.textContent=`Update to ${t} available!`),Re.style.display="inline",re()}}catch(n){console.error("Failed to check for updates:",n)}}async function Et(){x=await g.get(ke)||null,A=await g.get(ht)==="true",j=await g.get(mt)==="true",Nt(),await Wt(),await $t(),await Ut(),Zt(),f&&(!x||!j?(A?(V&&V.style.setProperty("display","block","important"),O&&O.style.setProperty("display","none","important"),te&&te.style.setProperty("display","none","important"),q&&q.style.setProperty("display","none","important"),b&&b.style.setProperty("display","none","important"),w&&w.style.setProperty("display","none","important"),!j&&z?z.style.display="block":z&&(z.style.display="none"),ie&&(ie.style.display="block")):K(!1),x||Be(),Oe()):(c.update&&clearInterval(c.update),$e(),c.update=setInterval($e,15e3),A?(O&&O.style.setProperty("display","flex","important"),te&&te.style.setProperty("display","block","important"),q&&q.style.setProperty("display","block","important"),V&&V.style.setProperty("display","none","important"),ie&&(ie.style.display="none"),z&&(z.style.display="none")):K(!0)),setTimeout(re,100))}document.readyState==="complete"||document.readyState==="interactive"?Et():document.addEventListener("DOMContentLoaded",Et)})();
